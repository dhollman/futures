<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>p1054R0: A Unified Futures Proposal for C++</title>
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in §N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: medium;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red;  text-decoration: line-through; }
	ins { color: #080; text-decoration: underline;    }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
		border-bottom-width: 3px !important;
		margin-bottom: 0px !important;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li li { font-size:   85%;    }

	.toc > li             { margin: 1.5rem 0;    }
	.toc > li li          { margin: 0.3rem 0;    }
	.toc > li li li       { margin-left: 2rem;   }

	/* Section numbers in a column of their own */
	.toc .secno {
		float: left;
		width: 4rem;
		white-space: nowrap;
	}
	.toc > li li li li .secno {
		font-size: 85%;
	}
	.toc > li li li li li .secno {
		font-size: 100%;
	}

	:not(li) > .toc              { margin-left:  5rem; }
	.toc .secno                  { margin-left: -5rem; }
	.toc > li li li .secno       { margin-left: -7rem; }
	.toc > li li li li .secno    { margin-left: -9rem; }
	.toc > li li li li li .secno { margin-left: -11rem; }

	/* Tighten up indentation in narrow ToCs */
	@media (max-width: 30em) {
		:not(li) > .toc              { margin-left:  4rem; }
		.toc .secno                  { margin-left: -4rem; }
		.toc > li li li              { margin-left:  1rem; }
		.toc > li li li .secno       { margin-left: -5rem; }
		.toc > li li li li .secno    { margin-left: -6rem; }
		.toc > li li li li li .secno { margin-left: -7rem; }
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) :not(li) > .toc              { margin-left:  4rem; }
		body:not(.toc-inline) .toc .secno                  { margin-left: -4rem; }
		body:not(.toc-inline) .toc > li li li              { margin-left:  1rem; }
		body:not(.toc-inline) .toc > li li li .secno       { margin-left: -5rem; }
		body:not(.toc-inline) .toc > li li li li .secno    { margin-left: -6rem; }
		body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	body.toc-sidebar #toc :not(li) > .toc              { margin-left:  4rem; }
	body.toc-sidebar #toc .toc .secno                  { margin-left: -4rem; }
	body.toc-sidebar #toc .toc > li li li              { margin-left:  1rem; }
	body.toc-sidebar #toc .toc > li li li .secno       { margin-left: -5rem; }
	body.toc-sidebar #toc .toc > li li li li .secno    { margin-left: -6rem; }
	body.toc-sidebar #toc .toc > li li li li li .secno { margin-left: -7rem; }

	.toc li {
		clear: both;
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-left: calc(13px + 26.5rem - 50vw);
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-left: calc(40em - 50vw) !important;
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-left: 0 !important;
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
<style type="text/css">
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      vertical-align: top;
    }
    th, td {
      border-left: none;
      border-right: none;
      padding: 0px 10px;
    }
    th {
      text-align: center;
    }
  </style>
  <meta content="Bikeshed version 374411ba509d23f8a91b3530bae1f342eb291098" name="generator">
  <link href="wg21.link/P1054" rel="canonical">
  <meta content="313af310b912fd947a468da8dc37371535e6939c" name="document-revision">
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: gray;
    color: white;
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: black;
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: #005a9c;
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }
        .dfn-panel:not(.on) { display: none; }
        .dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
        .dfn-panel > b { display: block; }
        .dfn-panel a { color: black; }
        .dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
        .dfn-panel > b + b { margin-top: 0.25em; }
        .dfn-panel ul { padding: 0; }
        .dfn-panel li { list-style: inside; }
        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled { cursor: pointer; }
        </style>
<style>/* style-syntax-highlighting */

.highlight:not(.idl) { background: hsl(24, 20%, 95%); }
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
.highlight .c { color: #708090 } /* Comment */
.highlight .k { color: #990055 } /* Keyword */
.highlight .l { color: #000000 } /* Literal */
.highlight .n { color: #0077aa } /* Name */
.highlight .o { color: #999999 } /* Operator */
.highlight .p { color: #999999 } /* Punctuation */
.highlight .cm { color: #708090 } /* Comment.Multiline */
.highlight .cp { color: #708090 } /* Comment.Preproc */
.highlight .c1 { color: #708090 } /* Comment.Single */
.highlight .cs { color: #708090 } /* Comment.Special */
.highlight .kc { color: #990055 } /* Keyword.Constant */
.highlight .kd { color: #990055 } /* Keyword.Declaration */
.highlight .kn { color: #990055 } /* Keyword.Namespace */
.highlight .kp { color: #990055 } /* Keyword.Pseudo */
.highlight .kr { color: #990055 } /* Keyword.Reserved */
.highlight .kt { color: #990055 } /* Keyword.Type */
.highlight .ld { color: #000000 } /* Literal.Date */
.highlight .m { color: #000000 } /* Literal.Number */
.highlight .s { color: #a67f59 } /* Literal.String */
.highlight .na { color: #0077aa } /* Name.Attribute */
.highlight .nc { color: #0077aa } /* Name.Class */
.highlight .no { color: #0077aa } /* Name.Constant */
.highlight .nd { color: #0077aa } /* Name.Decorator */
.highlight .ni { color: #0077aa } /* Name.Entity */
.highlight .ne { color: #0077aa } /* Name.Exception */
.highlight .nf { color: #0077aa } /* Name.Function */
.highlight .nl { color: #0077aa } /* Name.Label */
.highlight .nn { color: #0077aa } /* Name.Namespace */
.highlight .py { color: #0077aa } /* Name.Property */
.highlight .nt { color: #669900 } /* Name.Tag */
.highlight .nv { color: #222222 } /* Name.Variable */
.highlight .ow { color: #999999 } /* Operator.Word */
.highlight .mb { color: #000000 } /* Literal.Number.Bin */
.highlight .mf { color: #000000 } /* Literal.Number.Float */
.highlight .mh { color: #000000 } /* Literal.Number.Hex */
.highlight .mi { color: #000000 } /* Literal.Number.Integer */
.highlight .mo { color: #000000 } /* Literal.Number.Oct */
.highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
.highlight .sc { color: #a67f59 } /* Literal.String.Char */
.highlight .sd { color: #a67f59 } /* Literal.String.Doc */
.highlight .s2 { color: #a67f59 } /* Literal.String.Double */
.highlight .se { color: #a67f59 } /* Literal.String.Escape */
.highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
.highlight .si { color: #a67f59 } /* Literal.String.Interpol */
.highlight .sx { color: #a67f59 } /* Literal.String.Other */
.highlight .sr { color: #a67f59 } /* Literal.String.Regex */
.highlight .s1 { color: #a67f59 } /* Literal.String.Single */
.highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
.highlight .vc { color: #0077aa } /* Name.Variable.Class */
.highlight .vg { color: #0077aa } /* Name.Variable.Global */
.highlight .vi { color: #0077aa } /* Name.Variable.Instance */
.highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">p1054R0<br>A Unified Futures Proposal for C++</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Draft Proposal, <time class="dt-updated" datetime="2018-05-05">5 May 2018</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="wg21.link/P1054">wg21.link/P1054</a>
     <dt>Authors:
     <dd>
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:lwh@fb.com">Lee Howes</a> (<span class="p-org org">Facebook</span>)
     <dd>
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:brycelelbach@gmail.com">Bryce Adelstein Lelbach</a> (<span class="p-org org">NVIDIA</span>)
     <dd>
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:dshollm@sandia.gov">David S. Hollman</a> (<span class="p-org org">Sandia National Labs</span>)
     <dt>Audience:
     <dd>SG1
     <dt>Project:
     <dd>ISO JTC1/SC22/WG21: Programming Language C++
     <dt>Source:
     <dd><a href="https://github.com/executors/futures/blob/master/futures.bs">github.com/executors/futures/blob/master/futures.bs</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <hr title="Separator for header">
  </div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#proposed-new-wording"><span class="secno">2</span> <span class="content">Proposed New Wording</span></a>
     <ol class="toc">
      <li><a href="#futures"><span class="secno">2.1</span> <span class="content">Futures</span></a>
      <li><a href="#futurecontinuation-requirements"><span class="secno">2.2</span> <span class="content"><code class="highlight"><span class="n">FutureContinuation</span></code> Requirements</span></a>
      <li><a href="#semifuture-requirements"><span class="secno">2.3</span> <span class="content"><code class="highlight"><span class="n">SemiFuture</span></code> Requirements</span></a>
      <li><a href="#continuablefuture-requirements"><span class="secno">2.4</span> <span class="content"><code class="highlight"><span class="n">ContinuableFuture</span></code> Requirements</span></a>
      <li><a href="#sharedfuture-requirements"><span class="secno">2.5</span> <span class="content"><code class="highlight"><span class="n">SharedFuture</span></code> Requirements</span></a>
      <li><a href="#stdstandard_promise"><span class="secno">2.6</span> <span class="content"><code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">standard_promise</span></code></span></a>
      <li><a href="#stdstandard_semi_future"><span class="secno">2.7</span> <span class="content"><code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">standard_semi_future</span></code></span></a>
      <li><a href="#stdstandard_continuable_future"><span class="secno">2.8</span> <span class="content"><code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">standard_continuable_future</span></code></span></a>
      <li><a href="#stdstandard_shared_future"><span class="secno">2.9</span> <span class="content"><code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">standard_shared_future</span></code></span></a>
      <li><a href="#stdthis_threadfuture_wait"><span class="secno">2.10</span> <span class="content"><code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">future_wait</span></code></span></a>
     </ol>
    <li>
     <a href="#proposed-addition-to-executors-p0443"><span class="secno">3</span> <span class="content">Proposed Addition to Executors P0443</span></a>
     <ol class="toc">
      <li><a href="#proposed-solution"><span class="secno">3.1</span> <span class="content">Proposed solution</span></a>
     </ol>
    <li>
     <a href="#proposed-new-wording①"><span class="secno">4</span> <span class="content">Proposed New Wording</span></a>
     <ol class="toc">
      <li><a href="#11x-promise-requirements"><span class="secno">4.1</span> <span class="content">1.1.x <code class="highlight"><span class="n">Promise</span></code> requirements</span></a>
      <li><a href="#1332-promise-contract"><span class="secno">4.2</span> <span class="content">1.3.3.2 Promise contract</span></a>
      <li><a href="#1332-cancellable-promise-contract"><span class="secno">4.3</span> <span class="content">1.3.3.2 Cancellable promise contract</span></a>
     </ol>
    <li>
     <a href="#proposed-modifications-to-executors-p0443"><span class="secno">5</span> <span class="content">Proposed Modifications to Executors P0443</span></a>
     <ol class="toc">
      <li><a href="#future-requirements"><span class="secno">5.1</span> <span class="content">Future requirements</span></a>
      <li><a href="#twowayexecutor-requirements"><span class="secno">5.2</span> <span class="content">TwoWayExecutor requirements</span></a>
      <li><a href="#thenexecutor-requirements"><span class="secno">5.3</span> <span class="content">ThenExecutor requirements</span></a>
      <li><a href="#bulktwowayexecutor-requirements"><span class="secno">5.4</span> <span class="content">BulkTwoWayExecutor requirements</span></a>
      <li><a href="#bulkthenexecutor-requirements"><span class="secno">5.5</span> <span class="content">BulkThenExecutor requirements</span></a>
      <li><a href="#twoway_t-customization-points"><span class="secno">5.6</span> <span class="content">twoway_t customization points</span></a>
      <li><a href="#single_t-customization-points"><span class="secno">5.7</span> <span class="content">single_t customization points</span></a>
      <li><a href="#properties-to-indicate-if-blocking-and-directionality-may-be-adapted"><span class="secno">5.8</span> <span class="content">Properties to indicate if blocking and directionality may be adapted</span></a>
      <li><a href="#class-template-executor"><span class="secno">5.9</span> <span class="content">Class template executor</span></a>
      <li><a href="#executor-operations"><span class="secno">5.10</span> <span class="content">executor operations</span></a>
      <li><a href="#static_thread_pool-executor-types"><span class="secno">5.11</span> <span class="content">static_thread_pool executor types</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <p>Contributors:</p>
   <ul>
    <li data-md="">
     <p>Marshall Cline</p>
    <li data-md="">
     <p>Michał   Dominiak</p>
    <li data-md="">
     <p>Carter   Edwards</p>
    <li data-md="">
     <p>Jay      Feldblum</p>
    <li data-md="">
     <p>Andrii   Grynenko</p>
    <li data-md="">
     <p>Jared    Hoberock</p>
    <li data-md="">
     <p>Hartmut  Kaiser</p>
    <li data-md="">
     <p>Chris    Kohlhoff</p>
    <li data-md="">
     <p>Chris    Mysen</p>
    <li data-md="">
     <p>Eric     Niebler</p>
    <li data-md="">
     <p>Sean     Parent</p>
    <li data-md="">
     <p>Cory     Perry</p>
    <li data-md="">
     <p>Felix    Petriconi</p>
    <li data-md="">
     <p>Kirk     Shoop</p>
    <li data-md="">
     <p>Mathias  Stearn</p>
   </ul>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>TODO</p>
   <h2 class="heading settled" data-level="2" id="proposed-new-wording"><span class="secno">2. </span><span class="content">Proposed New Wording</span><a class="self-link" href="#proposed-new-wording"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="futures"><span class="secno">2.1. </span><span class="content">Futures</span><a class="self-link" href="#futures"></a></h3>
   <ol>
    <li data-md="">
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="future">future</dfn> is an object that represents a value that may not available yet.</p>
    <li data-md="">
     <p>A <a data-link-type="dfn" href="#future" id="ref-for-future">future</a> consists of two components: content and status.</p>
    <li data-md="">
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="future’s content|future content" data-noexport="" id="futures-content">future’s content</dfn> is either a value or error.</p>
    <li data-md="">
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="future’s status|future status" data-noexport="" id="futures-status">future’s status</dfn> is either <a data-link-type="dfn" href="#not-ready" id="ref-for-not-ready">not ready</a>, <a data-link-type="dfn" href="#ready" id="ref-for-ready">ready</a> or <a data-link-type="dfn">consumed</a>.</p>
    <li data-md="">
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="not ready|not ready future" data-noexport="" id="not-ready">not ready future</dfn> is a future whose content is not available yet.</p>
    <li data-md="">
     <p>A not ready future may be <dfn data-dfn-type="dfn" data-lt="made ready|make ready" data-noexport="" id="made-ready">made ready<a class="self-link" href="#made-ready"></a></dfn>, an operation that atomically sets the <a data-link-type="dfn" href="#futures-content" id="ref-for-futures-content">future’s content</a> and changes <a data-link-type="dfn" href="#futures-status" id="ref-for-futures-status">its status</a> to <a data-link-type="dfn" href="#ready" id="ref-for-ready①">ready</a>.</p>
    <li data-md="">
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="ready|ready future" data-noexport="" id="ready">ready future</dfn> is a future whose content is available.</p>
    <li data-md="">
     <p>A <dfn data-dfn-type="dfn" data-lt="valid|valid future" data-noexport="" id="valid">valid future<a class="self-link" href="#valid"></a></dfn> is a future whose <a data-link-type="dfn" href="#futures-content" id="ref-for-futures-content①">content</a> is available or may become available.</p>
    <li data-md="">
     <p>A <a data-link-type="dfn" href="#ready" id="ref-for-ready②">ready future</a> may be <dfn data-dfn-type="dfn" data-lt="made invalid|make invalid" data-noexport="" id="made-invalid">made invalid<a class="self-link" href="#made-invalid"></a></dfn>, an operation that atomically invalidates the <a data-link-type="dfn" href="#futures-content" id="ref-for-futures-content②">future’s content</a> and changes <a data-link-type="dfn" href="#futures-status" id="ref-for-futures-status①">its status</a> to <a data-link-type="dfn" href="#invalid" id="ref-for-invalid">invalid</a>.</p>
    <li data-md="">
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="invalid|invalid future" data-noexport="" id="invalid">invalid future</dfn> is a future whose <a data-link-type="dfn" href="#futures-content" id="ref-for-futures-content③">content</a> was available previously and is now unavailable, or for which <a data-link-type="dfn" href="#futures-content" id="ref-for-futures-content④">content</a> can never become available.</p>
    <li data-md="">
     <p>A program has undefined behavior if it accesses the <a data-link-type="dfn" href="#futures-content" id="ref-for-futures-content⑤">content</a> of a <a data-link-type="dfn" href="#not-ready" id="ref-for-not-ready①">not ready</a> or <a data-link-type="dfn" href="#invalid" id="ref-for-invalid①">invalid future</a>.</p>
   </ol>
   <h3 class="heading settled" data-level="2.2" id="futurecontinuation-requirements"><span class="secno">2.2. </span><span class="content"><code class="highlight"><span class="n">FutureContinuation</span></code> Requirements</span><a class="self-link" href="#futurecontinuation-requirements"></a></h3>
<pre class="highlight"><span class="k">namespace</span> <span class="n">std</span> <span class="p">{</span>

<span class="k">struct</span> <span class="n">exception_arg_t</span> <span class="p">{</span> <span class="k">explicit</span> <span class="n">exception_arg_t</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> <span class="p">};</span>

<span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">exception_arg_t</span> <span class="n">exception_arg</span><span class="p">{};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="o">></span>
  <span class="k">struct</span> <span class="n">is_future_value_continuation</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="o">></span>
  <span class="kr">inline</span> <span class="k">constexpr</span> <span class="kt">bool</span> <span class="n">is_future_value_continuation_v</span>
    <span class="o">=</span> <span class="n">is_future_value_continuation</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span> <span class="n">T</span><span class="o">>::</span><span class="n">value</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">></span>
  <span class="k">struct</span> <span class="n">is_future_exception_continuation</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">></span>
  <span class="kr">inline</span> <span class="k">constexpr</span> <span class="kt">bool</span> <span class="n">is_future_exception_continuation_v</span>
    <span class="o">=</span> <span class="n">is_future_exception_continuation</span><span class="o">&lt;</span><span class="n">F</span><span class="o">>::</span><span class="n">value</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="o">></span>
  <span class="k">struct</span> <span class="n">is_future_continuation</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="o">></span>
  <span class="kr">inline</span> <span class="k">constexpr</span> <span class="kt">bool</span> <span class="n">is_future_continuation_v</span>
    <span class="o">=</span> <span class="n">is_future_continuation</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span> <span class="n">T</span><span class="o">>::</span><span class="n">value</span><span class="p">;</span>

<span class="p">}</span>
</pre>
   <ol>
    <li data-md="">
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="future-continuation">future continuation</dfn> is a <a href="eel.is/c++draft/func.def">callable object</a> that consumes the value of a <a data-link-type="dfn" href="#future" id="ref-for-future①">future</a>.</p>
    <li data-md="">
     <p>The struct <code class="highlight"><span class="n">exception_arg_t</span></code> is an empty structure type used as a unique type to disambiguate <code class="highlight"><span class="n">FutureContinuation</span></code> overloads that are called when a <a data-link-type="dfn" href="#future" id="ref-for-future②">future</a>'s <a data-link-type="dfn">shared state</a> holds an exception from <code class="highlight"><span class="n">FutureContinuation</span></code> overloads that are called when a <a data-link-type="dfn" href="#future" id="ref-for-future③">future</a>'s <a data-link-type="dfn">shared state</a> holds a value.</p>
    <li data-md="">
     <p>This sub-clause contains templates that may be used to determine at compile time whether a type meets the requirements of <a data-link-type="dfn" href="#future-continuation" id="ref-for-future-continuation">future continuations</a> for a particular <a data-link-type="dfn" href="#future" id="ref-for-future④">future</a> value type. Each of these templates is a <a href="http://eel.is/c++draft/meta.rqmts#def:BinaryTypeTraith"><code class="highlight"><span class="n">BinaryTypeTrait</span></code></a> with a base characteristic of <code class="highlight"><span class="n">true_type</span></code> if the corresponding condition is true and <code class="highlight">false</code> otherwise.</p>
    <li data-md="">
     <p>A <code class="highlight"><span class="n">FutureContinuation</span></code> type shall meet the <code class="highlight"><span class="n">MoveConstructible</span></code> requirements and the requirements described in the Tables below.</p>
   </ol>
   <center>
    <p><strong>Type Property Queries</strong></p>
    <table border="1">
     <tbody>
      <tr>
       <th>Template
       <th>Condition
       <th>Preconditions
      <tr>
       <td>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="o">></span>
<span class="k">struct</span> <span class="n">is_future_value_continuation</span><span class="p">;</span>
</pre>
       <td><code class="highlight"><span class="n">is_move_constructible_v</span><span class="o">&lt;</span><span class="n">F</span><span class="o">></span> <span class="o">&amp;&amp;</span> <span class="n">is_invocable_v</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span> <span class="n">T</span><span class="o">></span></code>
       <td><code class="highlight"><span class="n">T</span></code> is a complete type.
      <tr>
       <td>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">></span>
<span class="k">struct</span> <span class="n">is_future_exception_continuation</span><span class="p">;</span>
</pre>
       <td><code class="highlight"><span class="n">is_move_constructible_v</span><span class="o">&lt;</span><span class="n">F</span><span class="o">></span> <span class="o">&amp;&amp;</span> <span class="n">is_invocable_v</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span> <span class="n">exception_arg_t</span><span class="p">,</span> <span class="n">exception_ptr</span><span class="o">></span></code>
       <td><code class="highlight"><span class="n">T</span></code> is a complete type.
      <tr>
       <td>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="o">></span>
<span class="k">struct</span> <span class="n">is_future_continuation</span><span class="p">;</span>
</pre>
       <td><code class="highlight"><span class="n">is_future_value_continuation</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span> <span class="n">T</span><span class="o">></span> <span class="o">||</span> <span class="n">is_future_exception_continuation</span><span class="o">&lt;</span><span class="n">F</span><span class="o">></span></code>
       <td><code class="highlight"><span class="n">T</span></code> is a complete type.
    </table>
   </center>
   <h3 class="heading settled" data-level="2.3" id="semifuture-requirements"><span class="secno">2.3. </span><span class="content"><code class="highlight"><span class="n">SemiFuture</span></code> Requirements</span><a class="self-link" href="#semifuture-requirements"></a></h3>
   <ol>
    <li data-md="">
     <p>A <dfn data-dfn-type="dfn" data-noexport="" id="semi-future">semi future<a class="self-link" href="#semi-future"></a></dfn> is an object that can be bound to an executor to produce a <a data-link-type="dfn" href="#future" id="ref-for-future⑤">future</a>.</p>
    <li data-md="">
     <p>A <code class="highlight"><span class="n">SemiFuture</span></code> type for type <code class="highlight"><span class="n">T</span></code> shall meet the <code class="highlight"><span class="n">MoveConstructible</span></code> requirements, the <code class="highlight"><span class="n">MoveAssignable</span></code> requirements, and the requirements described in the Tables below.</p>
   </ol>
   <center>
    <p><strong>Descriptive Variable Definitions</strong></p>
    <table border="1">
     <tbody>
      <tr>
       <th>Variable
       <th>Definition
      <tr>
       <td><code class="highlight"><span class="n">T</span></code>
       <td>
         Either: 
        <ul>
         <li data-md="">
          <p>Any (possibly cv-qualified) object type that is not an array, or</p>
         <li data-md="">
          <p>(possibly cv-qualified) <code class="highlight"><span class="kt">void</span></code>.</p>
        </ul>
      <tr>
       <td><code class="highlight"><span class="n">SF</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span></code>
       <td>A <code class="highlight"><span class="n">SemiFuture</span></code> type for value type <code class="highlight"><span class="n">T</span></code>.
      <tr>
       <td><code class="highlight"><span class="n">sf</span></code>
       <td>An rvalue of type <code class="highlight"><span class="n">SF</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span></code>.
      <tr>
       <td><code class="highlight"><span class="n">E</span></code>
       <td>
         An executor type, either: 
        <ul>
         <li data-md="">
          <p>A <code class="highlight"><span class="n">ThenExecutor</span></code> such that <code class="highlight"><span class="n">promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">>::</span><span class="n">static_query_v</span><span class="o">&lt;</span><span class="n">E</span><span class="o">></span> <span class="o">==</span> true</code>, or</p>
         <li data-md="">
          <p>An <code class="highlight"><span class="n">OneWayExecutor</span></code> otherwise.</p>
        </ul>
      <tr>
       <td><code class="highlight"><span class="n">e</span></code>
       <td>A value of type <code class="highlight"><span class="n">E</span></code>.
      <tr>
       <td><code class="highlight"><span class="n">CF</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">></span></code>
       <td>
         A <code class="highlight"><span class="n">ContinuableFuture</span></code> type for value type <code class="highlight"><span class="n">T</span></code> and executor type <code class="highlight"><span class="n">E</span></code>, either: 
        <ul>
         <li data-md="">
          <p><code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">get_promise</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">().</span><span class="n">second</span><span class="p">)</span></code> if <code class="highlight"><span class="n">E</span></code> is a <code class="highlight"><span class="n">ThenExecutor</span></code> and <code class="highlight"><span class="n">promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">>::</span><span class="n">static_query_v</span><span class="o">&lt;</span><span class="n">E</span><span class="o">></span> <span class="o">==</span> true</code>, or</p>
         <li data-md="">
          <p><code class="highlight"><span class="n">continuable_future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span></code> otherwise.</p>
        </ul>
    </table>
    <p><b><code class="highlight"><span class="n">SemiFuture</span></code> Requirements</b></p>
    <table border="1">
     <tbody>
      <tr>
       <th>Expression
       <th>Return Type
       <th>Operational Semantics
      <tr>
       <td><code class="highlight"><span class="n">future_value_t</span><span class="o">&lt;</span><span class="n">SF</span><span class="o">&lt;</span><span class="n">T</span><span class="o">>></span></code>
       <td><code class="highlight"><span class="n">T</span></code>
       <td>
      <tr>
       <td><code class="highlight"><span class="n">future_exception_t</span><span class="o">&lt;</span><span class="n">SF</span><span class="o">&lt;</span><span class="n">T</span><span class="o">>></span></code>
       <td>Implicitly convertible to <code class="highlight"><span class="n">exception_ptr</span></code>.
       <td>
      <tr>
       <td><code class="highlight"><span class="n">sf</span><span class="p">.</span><span class="n">via</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></code>
       <td><em>implementation-defined</em>
       <td>
         <strong>Returns:</strong> A <code class="highlight"><span class="n">ContinuableFuture</span></code> for value type <code class="highlight"><span class="n">T</span></code> that is bound to the executor <code class="highlight"><span class="n">e</span></code> and will be made ready with the content of <code class="highlight"><span class="n">sf</span></code> when <code class="highlight"><span class="n">sf</span></code> is made ready. 
        <p><strong>Throws:</strong> If <code class="highlight"><span class="o">!</span><span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">).</span><span class="n">second</span></code>, throws any exception thrown by <code class="highlight"><span class="o">!</span><span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">oneway_t</span><span class="p">)</span></code>.</p>
    </table>
   </center>
   <h3 class="heading settled" data-level="2.4" id="continuablefuture-requirements"><span class="secno">2.4. </span><span class="content"><code class="highlight"><span class="n">ContinuableFuture</span></code> Requirements</span><a class="self-link" href="#continuablefuture-requirements"></a></h3>
   <ol>
    <li data-md="">
     <p>A <dfn data-dfn-type="dfn" data-noexport="" id="continuable-future">continuable future<a class="self-link" href="#continuable-future"></a></dfn> is a <a data-link-type="dfn" href="#future" id="ref-for-future⑥">future</a> that is bound to an executor and can have continuations attached to it.</p>
    <li data-md="">
     <p>A <code class="highlight"><span class="n">ContinuableFuture</span></code> shall meet the <code class="highlight"><span class="n">SemiFuture</span></code> requirements and the requirements described in the Tables below.</p>
   </ol>
   <center>
    <p><strong>Descriptive Variable Definitions</strong></p>
    <table border="1">
     <tbody>
      <tr>
       <th>Variable
       <th>Definition
      <tr>
       <td><code class="highlight"><span class="n">E</span></code>
       <td>An executor type.
      <tr>
       <td><code class="highlight"><span class="n">e</span></code>
       <td>A value of type <code class="highlight"><span class="n">E</span></code>.
      <tr>
       <td><code class="highlight"><span class="n">T</span></code>
       <td>
         Either: 
        <ul>
         <li data-md="">
          <p>Any (possibly cv-qualified) object type that is not an array, or</p>
         <li data-md="">
          <p>(possibly cv-qualified) <code class="highlight"><span class="kt">void</span></code>.</p>
        </ul>
      <tr>
       <td><code class="highlight"><span class="n">CF</span><span class="o">&lt;</span><span class="n">E</span><span class="p">,</span> <span class="n">T</span><span class="o">></span></code>
       <td>A <code class="highlight"><span class="n">ContinuableFuture</span></code> type for executor type <code class="highlight"><span class="n">E</span></code> and value type <code class="highlight"><span class="n">T</span></code>.
      <tr>
       <td><code class="highlight"><span class="n">cf</span></code>
       <td>A value of type <code class="highlight"><span class="n">CF</span><span class="o">&lt;</span><span class="n">E</span><span class="p">,</span> <span class="n">T</span><span class="o">></span></code>.
      <tr>
       <td><code class="highlight"><span class="n">rcf</span></code>
       <td>An rvalue of type <code class="highlight"><span class="n">CF</span><span class="o">&lt;</span><span class="n">E</span><span class="p">,</span> <span class="n">T</span><span class="o">></span></code>.
      <tr>
       <td><code class="highlight"><span class="n">val</span></code>
       <td>The value contained within the successfully completed future <code class="highlight"><span class="n">rcf</span></code>.
      <tr>
       <td><code class="highlight"><span class="n">ex</span></code>
       <td>The exception contained within the exceptionally completed future <code class="highlight"><span class="n">rcf</span></code>.
      <tr>
       <td><code class="highlight"><span class="n">G</span></code>
       <td>Any type such that <code class="highlight"><span class="n">is_future_continuation_v</span><span class="o">&lt;</span><span class="n">G</span><span class="p">,</span> <span class="n">T</span><span class="o">></span> <span class="o">==</span> true</code>.
      <tr>
       <td><code class="highlight"><span class="n">g</span></code>
       <td>An object of type <code class="highlight"><span class="n">G</span></code>.
      <tr>
       <td><code class="highlight"><span class="n">R</span></code> 
       <td>
         Either: 
        <ul>
         <li data-md="">
          <p>If <code class="highlight"><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">remove_cv_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">,</span> <span class="kt">void</span><span class="o">></span> <span class="o">==</span> true</code> and <code class="highlight"><span class="n">invoke</span><span class="p">(</span><span class="n">g</span><span class="p">)</span></code> is well formed, <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">g</span><span class="p">())</span></code>.</p>
         <li data-md="">
          <p>If <code class="highlight"><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">remove_cv_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">,</span> <span class="kt">void</span><span class="o">></span> <span class="o">!=</span> true</code> and <code class="highlight"><span class="n">invoke</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></code> is well formed, <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">val</span><span class="p">))</span></code>.</p>
         <li data-md="">
          <p>Otherwise, <code class="highlight"><span class="n">T</span></code>.</p>
        </ul>
      <tr>
       <td><code class="highlight"><span class="n">SF</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span></code>
       <td>A <code class="highlight"><span class="n">SemiFuture</span></code> type for value type <code class="highlight"><span class="n">T</span></code>.
      <tr>
       <td><code class="highlight"><span class="n">NORMAL</span></code>
       <td>
         Either: 
        <ul>
         <li data-md="">
          <p>If <code class="highlight"><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">remove_cv_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">,</span> <span class="kt">void</span><span class="o">></span> <span class="o">==</span> true</code>, <code class="highlight"><span class="n">DECAY_COPY</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">></span><span class="p">(</span><span class="n">g</span><span class="p">))()</span></code>, and</p>
         <li data-md="">
          <p>Otherwise, <code class="highlight"><span class="n">DECAY_COPY</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">></span><span class="p">(</span><span class="n">g</span><span class="p">))(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">val</span><span class="p">))</span></code>.</p>
        </ul>
      <tr>
       <td><code class="highlight"><span class="n">EXCEPTIONAL</span></code>
       <td> The expression <code class="highlight"><span class="n">DECAY_COPY</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">></span><span class="p">(</span><span class="n">f</span><span class="p">))(</span><span class="n">exception_arg</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span></code>. 
    </table>
    <p><b><code class="highlight"><span class="n">ContinuableFuture</span></code> Requirements</b></p>
    <table border="1">
     <tbody>
      <tr>
       <th>Expression
       <th>Return Type
       <th>Operational Semantics
      <tr>
       <td><code class="highlight"><span class="n">cf</span><span class="p">.</span><span class="n">get_executor</span><span class="p">()</span></code>
       <td><code class="highlight"><span class="n">E</span></code>
       <td> <strong>Returns:</strong> The executor that the future is bound to. 
      <tr>
       <td><code class="highlight"><span class="n">rcf</span><span class="p">.</span><span class="n">then</span><span class="p">(</span><span class="n">g</span><span class="p">)</span></code>
       <td><code class="highlight"><span class="n">CF</span><span class="o">&lt;</span><span class="n">E</span><span class="p">,</span> <span class="n">R</span><span class="o">></span></code>
       <td>
         <strong>Returns:</strong> A <code class="highlight"><span class="n">ContinuableFuture</span></code> that is bound to the executor <code class="highlight"><span class="n">e</span></code> and
    that wraps the type returned by execution of either the value or exception
    operations implemented in the continuation. 
        <p><strong>Effects:</strong> When <code class="highlight"><span class="n">rcf</span></code> becomes nonexceptionally ready, and if <code class="highlight"><span class="n">NORMAL</span></code> is a
      well-formed expression, creates an execution agent which invokes <code class="highlight"><span class="n">NORMAL</span></code> at most once, with the call to <code class="highlight"><span class="n">DECAY_COPY</span></code> being evaluated in the thread
      that called <code class="highlight"><span class="p">.</span><span class="n">then</span></code>.</p>
        <p>Otherwise, when <code class="highlight"><span class="n">rcf</span></code> becomes exceptionally ready, if <code class="highlight"><span class="n">EXCEPTIONAL</span></code> is a
      well-formed expression, creates an execution agent which invokes <code class="highlight"><span class="n">EXCEPTIONAL</span></code> at most once, with the call to <code class="highlight"><span class="n">DECAY_COPY</span></code> being evaluated
      in the thread that called <code class="highlight"><span class="p">.</span><span class="n">then</span></code>.</p>
        <p>If <code class="highlight"><span class="n">NORMAL</span></code> and <code class="highlight"><span class="n">EXCEPTIONAL</span></code> are both well-formed expressions, <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">EXCEPTIONAL</span><span class="p">)</span></code> shall be convertible to <code class="highlight"><span class="n">R</span></code>.</p>
        <p>If <code class="highlight"><span class="n">NORMAL</span></code> is not a well-formed expression and <code class="highlight"><span class="n">EXCEPTIONAL</span></code> is a
      well-formed expression, <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">EXCEPTIONAL</span><span class="p">)</span></code> shall be convertible to <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></code>.</p>
        <p>If neither <code class="highlight"><span class="n">NORMAL</span></code> nor <code class="highlight"><span class="n">EXCEPTIONAL</span></code> are well-formed expressions, the
      invocation of <code class="highlight"><span class="p">.</span><span class="n">then</span></code> shall be ill-formed.</p>
        <p>May block pending completion of <code class="highlight"><span class="n">NORMAL</span></code> or <code class="highlight"><span class="n">EXCEPTIONAL</span></code>.</p>
        <p>The invocation of <code class="highlight"><span class="p">.</span><span class="n">then</span></code> synchronizes with
      (C++Std [intro.multithread]) the invocation of <code class="highlight"><span class="n">f</span></code>.</p>
        <p>Stores the result of either the <code class="highlight"><span class="n">NORMAL</span></code> or <code class="highlight"><span class="n">EXCEPTIONAL</span></code> expression, or
      any exception thrown by either, in the associated shared state of the
      resulting <code class="highlight"><span class="n">ContinuableFuture</span></code>. Otherwise, stores either <code class="highlight"><span class="n">val</span></code> or <code class="highlight"><span class="n">e</span></code> in
      the associated shared state of the resulting <code class="highlight"><span class="n">ContinuableFuture</span></code>.</p>
        <p><strong>Synchronization:</strong> The destruction of the continuation that generates <code class="highlight"><span class="n">rcf</span></code>'s value synchronizes-with the start of <code class="highlight"><span class="n">g</span></code> and with the destruction
      of <code class="highlight"><span class="n">g</span></code>.</p>
    </table>
   </center>
   <h3 class="heading settled" data-level="2.5" id="sharedfuture-requirements"><span class="secno">2.5. </span><span class="content"><code class="highlight"><span class="n">SharedFuture</span></code> Requirements</span><a class="self-link" href="#sharedfuture-requirements"></a></h3>
   <ol>
    <li data-md="">
     <p>A <dfn data-dfn-type="dfn" data-noexport="" id="shared-future">shared future<a class="self-link" href="#shared-future"></a></dfn> is a <a data-link-type="dfn" href="#future" id="ref-for-future⑦">future</a> that is copyable, is bound to an executor and that allows one or more continuation to be attached to it.</p>
    <li data-md="">
     <p>A <code class="highlight"><span class="n">SharedFuture</span></code> shall meet the <code class="highlight"><span class="n">ContinuableFuture</span></code> requirements, the <code class="highlight"><span class="n">CopyConstructible</span></code> requirements, the <code class="highlight"><span class="n">CopyAssignable</span></code> requirements and the requirements described in the Tables below.</p>
   </ol>
   <center>
    <p>Descriptive Variable Definitions</p>
    <table border="1">
     <tbody>
      <tr>
       <th>Variable
       <th>Definition
      <tr>
       <td><code class="highlight"><span class="n">E</span></code>
       <td>An executor type.
      <tr>
       <td><code class="highlight"><span class="n">e</span></code>
       <td>A value of type <code class="highlight"><span class="n">E</span></code>.
      <tr>
       <td><code class="highlight"><span class="n">T</span></code>
       <td>Any (possibly cv-qualified) object type that is not an array.
      <tr>
       <td><code class="highlight"><span class="n">SHF</span><span class="o">&lt;</span><span class="n">E</span><span class="p">,</span> <span class="n">T</span><span class="o">></span></code>
       <td>A <code class="highlight"><span class="n">SharedFuture</span></code> type for executor type <code class="highlight"><span class="n">E</span></code> and value type <code class="highlight"><span class="n">T</span></code>.
      <tr>
       <td><code class="highlight"><span class="n">shf</span></code>
       <td>A value of type <code class="highlight"><span class="n">CF</span><span class="o">&lt;</span><span class="n">E</span><span class="p">,</span> <span class="n">F</span><span class="o">></span></code>.
      <tr>
       <td><code class="highlight"><span class="n">NORMAL</span></code>
       <td> The expression <code class="highlight"><span class="n">DECAY_COPY</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">></span><span class="p">(</span><span class="n">g</span><span class="p">))(</span><span class="n">val</span><span class="p">)</span></code> if <code class="highlight"><span class="n">T</span></code> is non-void and <code class="highlight"><span class="n">DECAY_COPY</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">></span><span class="p">(</span><span class="n">g</span><span class="p">))()</span></code> if <code class="highlight"><span class="n">T</span></code> is void, 
      <tr>
       <td><code class="highlight"><span class="n">EXCEPTIONAL</span></code>
       <td> The expression <code class="highlight"><span class="n">DECAY_COPY</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">></span><span class="p">(</span><span class="n">f</span><span class="p">))(</span><span class="n">exception_arg</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span></code>, 
    </table>
    <p><code class="highlight"><span class="n">SharedFuture</span></code> Requirements</p>
    <table border="1">
     <tbody>
      <tr>
       <th>Expression
       <th>Return Type
       <th>Operational Semantics
      <tr>
       <td><code class="highlight"><span class="n">shf</span><span class="p">.</span><span class="n">then</span><span class="p">(</span><span class="n">g</span><span class="p">)</span></code>
       <td>
         <strong>If</strong> <code class="highlight"><span class="n">T</span></code> is non-void and <code class="highlight"><span class="n">INVOKE</span><span class="p">(</span><span class="n">declval</span><span class="o">&lt;</span><span class="n">G</span><span class="o">></span><span class="p">(),</span> <span class="n">declval</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">())</span></code> or if <code class="highlight"><span class="n">T</span></code> is <code class="highlight"><span class="kt">void</span></code> and <code class="highlight"><span class="n">INVOKE</span><span class="p">(</span><span class="n">declval</span><span class="o">&lt;</span><span class="n">G</span><span class="o">></span><span class="p">())</span></code> is valid: 
        <p><code class="highlight"><span class="n">CF</span><span class="o">&lt;</span><span class="n">E</span><span class="p">,</span> <span class="k">decltype</span><span class="p">(</span><span class="n">INVOKE</span><span class="p">(</span><span class="n">declval</span><span class="o">&lt;</span><span class="n">G</span><span class="o">></span><span class="p">(),</span> <span class="n">declval</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">()))</span><span class="o">></span></code></p>
        <p><strong>Otherwise</strong>:</p>
        <p><code class="highlight"><span class="n">CF</span><span class="o">&lt;</span><span class="n">E</span><span class="p">,</span> <span class="n">T</span><span class="o">></span></code></p>
       <td>
         <strong>Returns:</strong> A <code class="highlight"><span class="n">ContinuableFuture</span></code> that is bound to the executor <code class="highlight"><span class="n">e</span></code> and
    that wraps the type returned by execution of either the value or exception
    operations implemented in the continuation. 
        <p><strong>Effects:</strong> When <code class="highlight"><span class="n">shf</span></code> becomes nonexceptionally ready, and if <code class="highlight"><span class="n">NORMAL</span></code> is a
      well-formed expression, creates an execution agent which invokes <code class="highlight"><span class="n">NORMAL</span></code> at most once, with the call to <code class="highlight"><span class="n">DECAY_COPY</span></code> being evaluated in the thread
      that called <code class="highlight"><span class="p">.</span><span class="n">then</span></code>.</p>
        <p>Otherwise, when <code class="highlight"><span class="n">shf</span></code> becomes exceptionally ready, if <code class="highlight"><span class="n">EXCEPTIONAL</span></code> is a
      well-formed expression, creates an execution agent which invokes <code class="highlight"><span class="n">EXCEPTIONAL</span></code> at most once, with the call to <code class="highlight"><span class="n">DECAY_COPY</span></code> being evaluated
      in the thread that called <code class="highlight"><span class="p">.</span><span class="n">then</span></code>.</p>
        <p>If <code class="highlight"><span class="n">NORMAL</span></code> and <code class="highlight"><span class="n">EXCEPTIONAL</span></code> are both well-formed expressions, <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">EXCEPTIONAL</span><span class="p">)</span></code> shall be convertible to <code class="highlight"><span class="n">R</span></code>.</p>
        <p>If <code class="highlight"><span class="n">NORMAL</span></code> is not a well-formed expression and <code class="highlight"><span class="n">EXCEPTIONAL</span></code> is a
      well-formed expression, <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">EXCEPTIONAL</span><span class="p">)</span></code> shall be convertible to <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></code>.</p>
        <p>If neither <code class="highlight"><span class="n">NORMAL</span></code> nor <code class="highlight"><span class="n">EXCEPTIONAL</span></code> are well-formed expressions, the
      invocation of <code class="highlight"><span class="p">.</span><span class="n">then</span></code> shall be ill-formed.</p>
        <p>May block pending completion of <code class="highlight"><span class="n">NORMAL</span></code> or <code class="highlight"><span class="n">EXCEPTIONAL</span></code>.</p>
        <p>The invocation of <code class="highlight"><span class="p">.</span><span class="n">then</span></code> synchronizes with
      (C++Std [intro.multithread]) the invocation of <code class="highlight"><span class="n">f</span></code>.</p>
        <p>Stores the result of either the <code class="highlight"><span class="n">NORMAL</span></code> or <code class="highlight"><span class="n">EXCEPTIONAL</span></code> expression, or
      any exception thrown by either, in the associated shared state of the
      resulting <code class="highlight"><span class="n">ContinuableFuture</span></code>. Otherwise, stores either <code class="highlight"><span class="n">val</span></code> or <code class="highlight"><span class="n">e</span></code> in
      the associated shared state of the resulting <code class="highlight"><span class="n">ContinuableFuture</span></code>.</p>
        <p><strong>Postconditions:</strong> Has no observable affect on <code class="highlight"><span class="n">sfh</span></code>.</p>
      <tr>
       <td><code class="highlight"><span class="n">shf</span><span class="p">.</span><span class="n">via</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></code>
       <td>Implementation-defined
       <td>
         <strong>Returns:</strong> A <code class="highlight"><span class="n">ContinuableFuture</span></code> for type <code class="highlight"><span class="n">T</span></code> that is bound to the executor <code class="highlight"><span class="n">e</span></code>. 
        <p><strong>Effect:</strong> Returns an implementation-defined <code class="highlight"><span class="n">ContinuableFuture</span></code> onto which continuations can be attached that will run on <code class="highlight"><span class="n">e</span></code>.</p>
        <p><strong>Success:</strong> Succeeds if:</p>
        <ul>
         <li data-md="">
          <p><code class="highlight"><span class="n">e</span></code> is a <code class="highlight"><span class="n">ThenExecutor</span></code> where <code class="highlight"><span class="n">INVOKE</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">[](</span><span class="n">T</span><span class="p">){},</span> <span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">).</span><span class="n">second</span><span class="p">)</span></code> or <code class="highlight"><span class="n">INVOKE</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">[](</span><span class="n">T</span><span class="o">&amp;</span><span class="p">){},</span> <span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">).</span><span class="n">second</span><span class="p">)</span></code> is valid.</p>
         <li data-md="">
          <p><code class="highlight"><span class="n">e</span></code> is a <code class="highlight"><span class="n">OnewayExecutor</span></code> or is convertible to a OnewayExecutor.</p>
        </ul>
        <p>Fails at compile-time otherwise.</p>
        <p><strong>Postconditions:</strong> Has no observable affect on <code class="highlight"><span class="n">sfh</span></code>.</p>
    </table>
   </center>
   <h3 class="heading settled" data-level="2.6" id="stdstandard_promise"><span class="secno">2.6. </span><span class="content"><code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">standard_promise</span></code></span><a class="self-link" href="#stdstandard_promise"></a></h3>
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">></span>
<span class="k">class</span> <span class="nc">standard_promise</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">using</span> <span class="n">promise_default_executor</span> <span class="o">=</span> <span class="n">implementation</span><span class="o">-</span><span class="n">defined</span><span class="p">;</span>

    <span class="n">standard_continuable_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">promise_default_executor</span><span class="o">></span>
      <span class="n">get_continuable_future</span><span class="p">();</span>

    <span class="n">standard_semi_future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span> <span class="n">get_semi_future</span><span class="p">();</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Value</span><span class="o">></span>
    <span class="kt">void</span> <span class="n">set_value</span><span class="p">(</span><span class="n">Value</span><span class="o">&amp;&amp;</span> <span class="n">val</span><span class="p">);</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Error</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">exception_ptr</span><span class="o">></span>
    <span class="kt">void</span> <span class="n">set_exception</span><span class="p">(</span><span class="n">Error</span><span class="o">&amp;&amp;</span> <span class="n">val</span><span class="p">);</span>
<span class="p">};</span>
</pre>
   <p>The default executor type for promises allows for efficient promise->future
code. This executor is intended for use only locally. It may be optimised
using thread-local storage and should not be constructible. It is not copyable
and its lifetime is not guaranteed to outlive a single continuation chain
starting with a promise.</p>
   <p><br></p>
<pre class="highlight"><span class="n">standard_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">promise_default_executor</span><span class="o">></span> <span class="n">get_continuable_future</span><span class="p">();</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Effects:</em> Obtained a <code class="highlight"><span class="n">standard_continuable_future</span></code> that completes on the
promise’s default executor when <code class="highlight"><span class="k">this</span><span class="o">-></span><span class="n">set_value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code> or <code class="highlight"><span class="k">this</span><span class="o">-></span><span class="n">set_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></code> is called.</p>
    <li data-md="">
     <p><em>Postconditions:</em> Further calls to <code class="highlight"><span class="n">get_continuable_future</span><span class="p">()</span></code> or
to <code class="highlight"><span class="n">get_semi_future</span><span class="p">()</span></code> will throw.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Value</span><span class="o">></span>
<span class="kt">void</span> <span class="n">set_value</span><span class="p">(</span><span class="n">Value</span><span class="o">&amp;&amp;</span> <span class="n">val</span><span class="p">);</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Requires:</em> The result of <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">Value</span><span class="o">></span></code> is <code class="highlight"><span class="n">T</span></code>.</p>
    <li data-md="">
     <p><em>Effects:</em> Completes the associated future with value <code class="highlight"><span class="n">val</span></code>.</p>
    <li data-md="">
     <p><em>Postconditions:</em> Further calls to <code class="highlight"><span class="n">set_value</span></code> or <code class="highlight"><span class="n">set_exception</span></code> may throw.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Error</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">exception_ptr</span><span class="o">></span>
<span class="kt">void</span> <span class="n">set_exception</span><span class="p">(</span><span class="n">Error</span><span class="o">&amp;&amp;</span> <span class="n">ex</span><span class="p">);</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Requires:</em> The result of <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">></span></code> is <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">exception_ptr</span></code>.</p>
    <li data-md="">
     <p><em>Effects:</em> Completes the associated future with exception <code class="highlight"><span class="n">ex</span></code>.</p>
    <li data-md="">
     <p><em>Postconditions:</em> Further calls to <code class="highlight"><span class="n">set_value</span></code> or <code class="highlight"><span class="n">set_exception</span></code> may throw.</p>
   </ul>
   <h3 class="heading settled" data-level="2.7" id="stdstandard_semi_future"><span class="secno">2.7. </span><span class="content"><code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">standard_semi_future</span></code></span><a class="self-link" href="#stdstandard_semi_future"></a></h3>
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">></span>
<span class="k">class</span> <span class="nc">standard_semi_future</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">using</span> <span class="n">value_type</span> <span class="o">=</span> <span class="n">T</span><span class="p">;</span>

    <span class="c1">// StandardSemiFuture may be constructed already complete</span>
<span class="c1"></span>    <span class="n">standard_semi_future</span><span class="p">(</span><span class="n">standard_semi_future</span><span class="o">&amp;&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
    <span class="n">standard_semi_future</span><span class="p">(</span><span class="k">const</span> <span class="n">standard_semi_future</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>

    <span class="n">standard_semi_future</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">standard_semi_future</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
    <span class="n">standard_semi_future</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">standard_semi_future</span><span class="o">&amp;&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">E</span><span class="o">></span>
    <span class="k">explicit</span> <span class="n">standard_semi_future</span><span class="p">(</span><span class="n">standard_continuable_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">>&amp;&amp;</span><span class="p">);</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">E</span><span class="o">></span>
    <span class="k">explicit</span> <span class="n">standard_semi_future</span><span class="p">(</span><span class="n">standard_shared_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">>&amp;&amp;</span><span class="p">);</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">EI</span><span class="p">,</span> <span class="k">class</span> <span class="nc">EO</span><span class="o">></span>
    <span class="c1">// Where EI and EO are  one-way or two-way executors.</span>
<span class="c1"></span>    <span class="c1">// EO must be derived from EI through the executor</span>
<span class="c1"></span>    <span class="c1">// requirement API.</span>
<span class="c1"></span>    <span class="n">standard_continuable_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">EO</span><span class="o">></span> <span class="n">via</span><span class="p">(</span><span class="n">EI</span><span class="p">)</span> <span class="o">&amp;&amp;</span><span class="p">;</span>
<span class="p">};</span>
</pre>
   <p><br></p>
<pre class="highlight"><span class="n">standard_continuable_future</span><span class="p">(</span><span class="n">standard_semi_future</span><span class="o">&amp;&amp;</span> <span class="n">rhs</span><span class="p">);</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Effects:</em> Move constructs a future object that refers to the shared state
that was originally referred to by rhs (if any).</p>
    <li data-md="">
     <p><em>Postconditions:</em></p>
     <ul>
      <li data-md="">
       <p>valid() returns the same value as rhs.valid() prior to the constructor
invocation.</p>
      <li data-md="">
       <p>rhs.valid() == false.</p>
     </ul>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="n">standard_semi_future</span><span class="p">(</span><span class="k">const</span> <span class="n">standard_semi_future</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">);</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Effects:</em> Copy constructs a future object that refers to the shared state
that was originally referred to by rhs (if any).</p>
    <li data-md="">
     <p><em>Postconditions:</em> valid() returns the same value as rhs.valid() prior to the
constructor invocation. The validity of rhs does not change.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">E</span><span class="o">></span>
<span class="n">standard_semi_future</span><span class="p">(</span><span class="n">standard_continuable_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">>&amp;&amp;</span> <span class="n">rhs</span><span class="p">);</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Effects:</em> Move constructs a future object that refers to the shared state that
was originally referred to by rhs (if any).</p>
    <li data-md="">
     <p><em>Postconditions:</em></p>
    <li data-md="">
     <p>valid() returns the same value as rhs.valid() prior to the constructor invocation.</p>
    <li data-md="">
     <p>rhs.valid() == false.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">E</span><span class="o">></span>
<span class="k">explicit</span> <span class="n">standard_semi_future</span><span class="p">(</span><span class="n">standard_shared_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">>&amp;&amp;</span> <span class="n">rhs</span><span class="p">);</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">E</span><span class="o">></span>
<span class="k">explicit</span> <span class="n">standard_semi_future</span><span class="p">(</span><span class="k">const</span> <span class="n">standard_shared_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">>&amp;</span> <span class="n">rhs</span><span class="p">);</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Effects:</em> Move constructs a future object that refers to the shared state
that was originally referred to by rhs (if any).</p>
    <li data-md="">
     <p><em>Postconditions:</em></p>
     <ul>
      <li data-md="">
       <p>valid() returns the same value as rhs.valid() prior to the constructor
invocation.</p>
      <li data-md="">
       <p>rhs.valid() == false.</p>
     </ul>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="n">standard_continuable_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">EI</span><span class="o">></span> <span class="n">via</span><span class="p">(</span><span class="n">EI</span> <span class="n">ex</span><span class="p">)</span> <span class="o">&amp;&amp;</span><span class="p">;</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Effects:</em> Returns a new future that will complete when this completes but
on which continuations will be enqueued to a new executor.</p>
    <li data-md="">
     <p><em>Returns:</em> A standard_continuable_future modified to carry executor ex of
type EI.</p>
    <li data-md="">
     <p><em>Requires:</em></p>
    <li data-md="">
     <p><code class="highlight"><span class="n">e</span></code> is a <code class="highlight"><span class="n">ThenExecutor</span></code> where <code class="highlight"><span class="n">INVOKE</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">[](</span><span class="n">T</span><span class="p">){},</span> <span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">).</span><span class="n">second</span><span class="p">)</span></code> or <code class="highlight"><span class="n">INVOKE</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">[](</span><span class="n">T</span><span class="o">&amp;</span><span class="p">){},</span> <span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">).</span><span class="n">second</span><span class="p">)</span></code> is valid.</p>
    <li data-md="">
     <p><code class="highlight"><span class="n">e</span></code> is a <code class="highlight"><span class="n">OnewayExecutor</span></code> or is convertible to a OnewayExecutor.</p>
    <li data-md="">
     <p><em>Postconditions:</em> valid() == false.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="kt">bool</span> <span class="nf">valid</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Returns:</em> Returns true if this is a valid future. False otherwise.</p>
   </ul>
   <h3 class="heading settled" data-level="2.8" id="stdstandard_continuable_future"><span class="secno">2.8. </span><span class="content"><code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">standard_continuable_future</span></code></span><a class="self-link" href="#stdstandard_continuable_future"></a></h3>
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">E</span><span class="o">></span>
<span class="k">class</span> <span class="nc">standard_continuable_future</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">using</span> <span class="n">value_type</span> <span class="o">=</span> <span class="n">T</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">executor_type</span> <span class="o">=</span> <span class="n">Ex</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">semi_future_type</span> <span class="o">=</span> <span class="n">standard_semi_future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">;</span>

    <span class="n">standard_continuable_future</span><span class="p">(</span><span class="k">const</span> <span class="n">standard_continuable_future</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
    <span class="n">standard_continuable_future</span><span class="p">(</span><span class="n">standard_continuable_future</span><span class="o">&amp;&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

    <span class="n">standard_continuable_future</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">standard_continuable_future</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
    <span class="n">standard_continuable_future</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">standard_continuable_future</span><span class="o">&amp;&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">E</span><span class="o">></span>
    <span class="k">explicit</span> <span class="n">standard_continuable_future</span><span class="p">(</span><span class="n">standard_shared_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">>&amp;&amp;</span><span class="p">);</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">E</span><span class="o">></span>
    <span class="k">explicit</span> <span class="n">standard_continuable_future</span><span class="p">(</span><span class="k">const</span> <span class="n">standard_shared_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">>&amp;</span><span class="p">);</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">ReturnFuture</span><span class="p">,</span> <span class="k">class</span> <span class="nc">F</span><span class="o">></span>
    <span class="c1">// Where ReturnFuture will satisfy the requirements of ContinuableFuture,</span>
<span class="c1"></span>    <span class="c1">// where is_same_t&lt;ReturnFuture::value_type, result_of_t&lt;decay_t&lt;F>(decay_t&lt;T>)>></span>
<span class="c1"></span>    <span class="c1">// and will either be an instance of standard_continuable_future or</span>
<span class="c1"></span>    <span class="c1">// executor_future_t&lt;EO, T> where EO has the same executor properties as</span>
<span class="c1"></span>    <span class="c1">// E but with the addition of the twoway_t property.</span>
<span class="c1"></span>    <span class="n">ReturnFuture</span> <span class="n">then</span><span class="p">(</span><span class="n">FutureContinuation</span><span class="o">&amp;&amp;</span><span class="p">)</span> <span class="o">&amp;&amp;</span><span class="p">;</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">EI</span><span class="p">,</span> <span class="k">class</span> <span class="nc">EO</span><span class="o">></span>
    <span class="c1">// Where EI and EO are  one-way or two-way executors.</span>
<span class="c1"></span>    <span class="c1">// EO must be derived from EI through the executor</span>
<span class="c1"></span>    <span class="c1">// requirement API.</span>
<span class="c1"></span>    <span class="n">standard_continuable_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">EO</span><span class="o">></span> <span class="n">via</span><span class="p">(</span><span class="n">EI</span><span class="p">)</span> <span class="o">&amp;&amp;</span><span class="p">;</span>

    <span class="n">E</span> <span class="nf">get_executor</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
    <span class="n">standard_semi_future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span> <span class="n">semi</span><span class="p">()</span> <span class="o">&amp;&amp;</span><span class="p">;</span>
    <span class="n">standard_shared_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">></span> <span class="n">share</span><span class="p">()</span> <span class="o">&amp;&amp;</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="nf">valid</span><span class="p">()</span> <span class="k">const</span>
<span class="p">}</span>
<span class="p">};</span>
</pre>
   <p><br></p>
<pre class="highlight"><span class="n">standard_continuable_future</span><span class="p">(</span><span class="n">standard_continuable_future</span><span class="o">&amp;&amp;</span> <span class="n">rhs</span><span class="p">);</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Effects:</em> Move constructs a future object that refers to the shared state
that was originally referred to by rhs (if any).</p>
    <li data-md="">
     <p><em>Postconditions:</em></p>
     <ul>
      <li data-md="">
       <p>valid() returns the same value as rhs.valid() prior to the constructor
invocation.</p>
      <li data-md="">
       <p>rhs.valid() == false.</p>
     </ul>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="n">standard_continuable_future</span><span class="p">(</span><span class="k">const</span> <span class="n">standard_continuable_future</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">);</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Effects:</em> Copy constructs a future object that refers to the shared state
that was originally referred to by rhs (if any).</p>
    <li data-md="">
     <p><em>Postconditions:</em> valid() returns the same value as rhs.valid() prior to the
constructor invocation. The validity of rhs does not change.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">E</span><span class="o">></span>
<span class="k">explicit</span> <span class="n">standard_continuable_future</span><span class="p">(</span><span class="n">standard_shared_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">>&amp;&amp;</span> <span class="n">rhs</span><span class="p">);</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">E</span><span class="o">></span>
<span class="k">explicit</span> <span class="n">standard_continuable_future</span><span class="p">(</span><span class="k">const</span> <span class="n">standard_shared_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">>&amp;</span> <span class="n">rhs</span><span class="p">);</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Effects:</em> Move constructs a future object that refers to the shared state that
was originally referred to by rhs (if any).</p>
    <li data-md="">
     <p><em>Postconditions:</em></p>
     <ul>
      <li data-md="">
       <p>valid() returns the same value as rhs.valid() prior to the constructor
invocation.</p>
      <li data-md="">
       <p>rhs.valid() == false.</p>
     </ul>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">ReturnFuture</span><span class="p">,</span> <span class="k">class</span> <span class="nc">F</span><span class="o">></span>
<span class="n">ReturnFuture</span> <span class="n">then</span><span class="p">(</span><span class="n">F</span><span class="o">&amp;&amp;</span><span class="p">)</span> <span class="o">&amp;&amp;</span><span class="p">;</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Requires:</em> F satisfies the requirements of FutureContinuation.</p>
    <li data-md="">
     <p><em>Returns:</em> A <code class="highlight"><span class="n">ContinuableFuture</span></code> that is bound to the executor <code class="highlight"><span class="n">e</span></code> and
that wraps the type returned by execution of either the value or exception
operations implemented in the continuation. The type of the returned <code class="highlight"><span class="n">ContinuableFuture</span></code> is defined by <code class="highlight"><span class="n">Executor</span></code> <code class="highlight"><span class="n">E</span></code>.</p>
    <li data-md="">
     <p><em>Effects:</em></p>
     <ul>
      <li data-md="">
       <p>For <code class="highlight"><span class="n">NORMAL</span></code> defined as the expression <code class="highlight"><span class="n">DECAY_COPY</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">></span><span class="p">(</span><span class="n">g</span><span class="p">))(</span><span class="n">val</span><span class="p">)</span></code> if <code class="highlight"><span class="n">T</span></code> is non-void and <code class="highlight"><span class="n">DECAY_COPY</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">></span><span class="p">(</span><span class="n">g</span><span class="p">))()</span></code> if <code class="highlight"><span class="n">T</span></code> is void.</p>
      <li data-md="">
       <p>For <code class="highlight"><span class="n">EXCEPTIONAL</span></code> defined as the expression <code class="highlight"><span class="n">DECAY_COPY</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">></span><span class="p">(</span><span class="n">f</span><span class="p">))(</span><span class="n">exception_arg</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span></code>,</p>
      <li data-md="">
       <p>When <code class="highlight"><span class="o">*</span><span class="k">this</span></code> becomes nonexceptionally ready, and if <code class="highlight"><span class="n">NORMAL</span></code> is a
well-formed expression, creates an execution agent which invokes <code class="highlight"><span class="n">NORMAL</span></code> at most once, with the call to <code class="highlight"><span class="n">DECAY_COPY</span></code> being evaluated in the thread
that called <code class="highlight"><span class="p">.</span><span class="n">then</span></code>.</p>
      <li data-md="">
       <p>Otherwise, when <code class="highlight"><span class="o">*</span><span class="k">this</span></code> becomes exceptionally ready, if <code class="highlight"><span class="n">EXCEPTIONAL</span></code> is a
well-formed expression, creates an execution agent which invokes <code class="highlight"><span class="n">EXCEPTIONAL</span></code> at most once, with the call to <code class="highlight"><span class="n">DECAY_COPY</span></code> being evaluated
in the thread that called <code class="highlight"><span class="p">.</span><span class="n">then</span></code>.</p>
      <li data-md="">
       <p>If <code class="highlight"><span class="n">NORMAL</span></code> and <code class="highlight"><span class="n">EXCEPTIONAL</span></code> are both well-formed expressions, <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">EXCEPTIONAL</span><span class="p">)</span></code> shall be convertible to <code class="highlight"><span class="n">R</span></code>.</p>
      <li data-md="">
       <p>If <code class="highlight"><span class="n">NORMAL</span></code> is not a well-formed expression and <code class="highlight"><span class="n">EXCEPTIONAL</span></code> is a
well-formed expression, <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">EXCEPTIONAL</span><span class="p">)</span></code> shall be convertible to <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></code>.</p>
      <li data-md="">
       <p>If neither <code class="highlight"><span class="n">NORMAL</span></code> nor <code class="highlight"><span class="n">EXCEPTIONAL</span></code> are well-formed expressions, the
invocation of <code class="highlight"><span class="p">.</span><span class="n">then</span></code> shall be ill-formed.</p>
      <li data-md="">
       <p>May block pending completion of <code class="highlight"><span class="n">NORMAL</span></code> or <code class="highlight"><span class="n">EXCEPTIONAL</span></code>.</p>
      <li data-md="">
       <p>The invocation of <code class="highlight"><span class="p">.</span><span class="n">then</span></code> synchronizes with
(C++Std [intro.multithread]) the invocation of <code class="highlight"><span class="n">f</span></code>.</p>
      <li data-md="">
       <p>Stores the result of either the <code class="highlight"><span class="n">NORMAL</span></code> or <code class="highlight"><span class="n">EXCEPTIONAL</span></code> expression, or
any exception thrown by either, in the associated shared state of the
resulting <code class="highlight"><span class="n">ContinuableFuture</span></code>. Otherwise, stores either <code class="highlight"><span class="n">val</span></code> or <code class="highlight"><span class="n">e</span></code> in
the associated shared state of the resulting <code class="highlight"><span class="n">ContinuableFuture</span></code>.</p>
     </ul>
    <li data-md="">
     <p><em>Postconditions:</em> valid() == false.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="n">standard_continuable_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">EI</span><span class="o">></span> <span class="n">via</span><span class="p">(</span><span class="n">EI</span> <span class="n">ex</span><span class="p">)</span> <span class="o">&amp;&amp;</span><span class="p">;</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Effects:</em> Returns a new future that will complete when this completes but
on which continuations will be enqueued to a new executor.</p>
    <li data-md="">
     <p><em>Returns:</em> A standard_continuable_future modified to carry executor ex of
type EI.</p>
    <li data-md="">
     <p><em>Requires:</em></p>
    <li data-md="">
     <p><code class="highlight"><span class="n">e</span></code> is a <code class="highlight"><span class="n">ThenExecutor</span></code> where <code class="highlight"><span class="n">INVOKE</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">[](</span><span class="n">T</span><span class="p">){},</span> <span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">).</span><span class="n">second</span><span class="p">)</span></code> or <code class="highlight"><span class="n">INVOKE</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">[](</span><span class="n">T</span><span class="o">&amp;</span><span class="p">){},</span> <span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">).</span><span class="n">second</span><span class="p">)</span></code> is valid.</p>
    <li data-md="">
     <p><code class="highlight"><span class="n">e</span></code> is a <code class="highlight"><span class="n">OnewayExecutor</span></code> or is convertible to a OnewayExecutor.</p>
    <li data-md="">
     <p><em>Postconditions:</em> valid() == false.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="n">E</span> <span class="nf">get_executor</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Returns:</em> If is_valid() returns true returns the executor contained within the
future. Otherwise throws std::future_error.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="n">standard_semi_future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span> <span class="n">semi</span><span class="p">()</span> <span class="o">&amp;&amp;</span><span class="p">;</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Returns:</em> Returns a standard_semi_future of the same value type as *this and that
completes when this completes, but that erases the executor. is_valid() on the
returned standard_semi_future will return the same value as is_valid() on
*this.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="kt">bool</span> <span class="nf">valid</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Returns:</em> Returns true if this is a valid future. False otherwise.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="n">standard_shared_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">></span> <span class="n">share</span><span class="p">()</span> <span class="o">&amp;&amp;</span><span class="p">;</span>
</pre>
   <ul>
    <li data-md="">
     <p>
      <em>Returns:</em> standard_shared_future
      <r>(std::move(*this)).</r>
     </p>
    <li data-md="">
     <p><em>Postconditions:</em> valid() == false.</p>
   </ul>
   <h3 class="heading settled" data-level="2.9" id="stdstandard_shared_future"><span class="secno">2.9. </span><span class="content"><code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">standard_shared_future</span></code></span><a class="self-link" href="#stdstandard_shared_future"></a></h3>
<pre class="highlight"><span class="k">namespace</span> <span class="n">std</span> <span class="p">{</span>
  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">E</span><span class="o">></span>
  <span class="k">class</span> <span class="nc">standard_shared_future</span> <span class="p">{</span>
  <span class="k">public</span><span class="o">:</span>
      <span class="k">using</span> <span class="n">value_type</span> <span class="o">=</span> <span class="n">T</span><span class="p">;</span>
      <span class="k">using</span> <span class="n">executor_type</span> <span class="o">=</span> <span class="n">Ex</span><span class="p">;</span>
      <span class="k">using</span> <span class="n">semi_future_type</span> <span class="o">=</span> <span class="n">standard_semi_future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">;</span>

      <span class="n">standard_shared_future</span><span class="p">(</span><span class="k">const</span> <span class="n">standard_shared_future</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
      <span class="n">standard_shared_future</span><span class="p">(</span><span class="n">standard_shared_future</span><span class="o">&amp;&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

      <span class="n">standard_shared_future</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">standard_shared_future</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">default</span>
      <span class="n">standard_shared_future</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">standard_shared_future</span><span class="o">&amp;&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

      <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">E</span><span class="o">></span>
      <span class="k">explicit</span> <span class="n">standard_shared_future</span><span class="p">(</span><span class="n">standard_continuable_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">>&amp;&amp;</span><span class="p">);</span>

      <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">ReturnFuture</span><span class="p">,</span> <span class="k">class</span> <span class="nc">F</span><span class="o">></span>
      <span class="n">ReturnFuture</span> <span class="n">then</span><span class="p">(</span><span class="n">FutureContinuation</span><span class="o">&amp;&amp;</span><span class="p">);</span>

      <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">EI</span><span class="o">></span>
      <span class="n">standard_shared_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">EI</span><span class="o">></span> <span class="n">via</span><span class="p">(</span><span class="n">EI</span><span class="p">);</span>

      <span class="n">E</span> <span class="nf">get_executor</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
      <span class="n">standard_semi_future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span> <span class="n">semi</span><span class="p">();</span>

      <span class="kt">bool</span> <span class="nf">valid</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span>
</pre>
   <p><br></p>
<pre class="highlight"><span class="n">standard_shared_future</span><span class="p">(</span><span class="n">standard_shared_future</span><span class="o">&amp;&amp;</span> <span class="n">rhs</span><span class="p">);</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Effects:</em> Move constructs a future object that refers to the shared state that
  was originally referred to by rhs (if any).</p>
    <li data-md="">
     <p><em>Postconditions:</em></p>
     <ul>
      <li data-md="">
       <p>valid() returns the same value as rhs.valid() prior to the constructor invocation.</p>
      <li data-md="">
       <p>rhs.valid() == false.</p>
     </ul>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="n">standard_shared_future</span><span class="p">(</span><span class="k">const</span> <span class="n">standard_shared_future</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">);</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Effects:</em> Copy constructs a future object that refers to the shared state that was originally referred to by rhs (if any).</p>
    <li data-md="">
     <p><em>Postconditions:</em> valid() returns the same value as rhs.valid() prior to the constructor invocation. The validity of rhs does not change.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="k">explicit</span> <span class="nf">standard_shared_future</span><span class="p">(</span><span class="n">standard_continuable_future</span><span class="o">&amp;&amp;</span> <span class="n">rhs</span><span class="p">);</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Effects:</em> Move constructs a future object that refers to the shared state that
  was originally referred to by rhs (if any).</p>
    <li data-md="">
     <p><em>Postconditions:</em></p>
     <ul>
      <li data-md="">
       <p>valid() returns the same value as rhs.valid() prior to the constructor invocation.</p>
      <li data-md="">
       <p>rhs.valid() == false.</p>
     </ul>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">ReturnFuture</span><span class="p">,</span> <span class="k">class</span> <span class="nc">F</span><span class="o">></span>
<span class="n">ReturnFuture</span> <span class="n">then</span><span class="p">(</span><span class="n">F</span><span class="o">&amp;&amp;</span><span class="p">);</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Requires:</em> F satisfies the requirements of FutureContinuation.</p>
    <li data-md="">
     <p><em>Returns:</em> A <code class="highlight"><span class="n">ContinuableFuture</span></code> that is bound to the executor <code class="highlight"><span class="n">e</span></code> and
  that wraps the type returned by execution of either the value or exception
  operations implemented in the continuation. The type of the returned <code class="highlight"><span class="n">ContinuableFuture</span></code> is defined by <code class="highlight"><span class="n">Executor</span></code> <code class="highlight"><span class="n">E</span></code>.</p>
    <li data-md="">
     <p><em>Effects:</em></p>
     <ul>
      <li data-md="">
       <p>For <code class="highlight"><span class="n">NORMAL</span></code> defined as the expression <code class="highlight"><span class="n">DECAY_COPY</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">></span><span class="p">(</span><span class="n">g</span><span class="p">))(</span><span class="n">val</span><span class="p">)</span></code> if <code class="highlight"><span class="n">T</span></code> is non-void and <code class="highlight"><span class="n">DECAY_COPY</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">></span><span class="p">(</span><span class="n">g</span><span class="p">))()</span></code> if <code class="highlight"><span class="n">T</span></code> is void.</p>
      <li data-md="">
       <p>For <code class="highlight"><span class="n">EXCEPTIONAL</span></code> defined as the expression <code class="highlight"><span class="n">DECAY_COPY</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">></span><span class="p">(</span><span class="n">f</span><span class="p">))(</span><span class="n">exception_arg</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span></code>,</p>
      <li data-md="">
       <p>When <code class="highlight"><span class="o">*</span><span class="k">this</span></code> becomes nonexceptionally ready, and if <code class="highlight"><span class="n">NORMAL</span></code> is a
well-formed expression, creates an execution agent which invokes <code class="highlight"><span class="n">NORMAL</span></code> at most once, with the call to <code class="highlight"><span class="n">DECAY_COPY</span></code> being evaluated in the thread
that called <code class="highlight"><span class="p">.</span><span class="n">then</span></code>.</p>
      <li data-md="">
       <p>Otherwise, when <code class="highlight"><span class="o">*</span><span class="k">this</span></code> becomes exceptionally ready, if <code class="highlight"><span class="n">EXCEPTIONAL</span></code> is a
well-formed expression, creates an execution agent which invokes <code class="highlight"><span class="n">EXCEPTIONAL</span></code> at most once, with the call to <code class="highlight"><span class="n">DECAY_COPY</span></code> being evaluated
in the thread that called <code class="highlight"><span class="p">.</span><span class="n">then</span></code>.</p>
      <li data-md="">
       <p>If <code class="highlight"><span class="n">NORMAL</span></code> and <code class="highlight"><span class="n">EXCEPTIONAL</span></code> are both well-formed expressions, <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">EXCEPTIONAL</span><span class="p">)</span></code> shall be convertible to <code class="highlight"><span class="n">R</span></code>.</p>
      <li data-md="">
       <p>If <code class="highlight"><span class="n">NORMAL</span></code> is not a well-formed expression and <code class="highlight"><span class="n">EXCEPTIONAL</span></code> is a
well-formed expression, <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">EXCEPTIONAL</span><span class="p">)</span></code> shall be convertible to <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></code>.</p>
      <li data-md="">
       <p>If neither <code class="highlight"><span class="n">NORMAL</span></code> nor <code class="highlight"><span class="n">EXCEPTIONAL</span></code> are well-formed expressions, the
invocation of <code class="highlight"><span class="p">.</span><span class="n">then</span></code> shall be ill-formed.</p>
      <li data-md="">
       <p>May block pending completion of <code class="highlight"><span class="n">NORMAL</span></code> or <code class="highlight"><span class="n">EXCEPTIONAL</span></code>.</p>
      <li data-md="">
       <p>The invocation of <code class="highlight"><span class="p">.</span><span class="n">then</span></code> synchronizes with
(C++Std [intro.multithread]) the invocation of <code class="highlight"><span class="n">f</span></code>.</p>
      <li data-md="">
       <p>Stores the result of either the <code class="highlight"><span class="n">NORMAL</span></code> or <code class="highlight"><span class="n">EXCEPTIONAL</span></code> expression, or
any exception thrown by either, in the associated shared state of the
resulting <code class="highlight"><span class="n">ContinuableFuture</span></code>. Otherwise, stores either <code class="highlight"><span class="n">val</span></code> or <code class="highlight"><span class="n">e</span></code> in
the associated shared state of the resulting <code class="highlight"><span class="n">ContinuableFuture</span></code>.</p>
     </ul>
    <li data-md="">
     <p><em>Postconditions:</em> No observable change to *this.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="n">standard_shared_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">EI</span><span class="o">></span> <span class="n">via</span><span class="p">(</span><span class="n">EI</span> <span class="n">ex</span><span class="p">);</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Effects:</em> Returns a new future that will complete when this completes but
  on which continuations will be enqueued to a new executor.</p>
    <li data-md="">
     <p><em>Returns:</em> A standard_shared_future modified to carry executor ex of type EI.</p>
    <li data-md="">
     <p><em>Requires:</em></p>
    <li data-md="">
     <p><code class="highlight"><span class="n">e</span></code> is a <code class="highlight"><span class="n">ThenExecutor</span></code> where <code class="highlight"><span class="n">INVOKE</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">[](</span><span class="n">T</span><span class="p">){},</span> <span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">).</span><span class="n">second</span><span class="p">)</span></code> or <code class="highlight"><span class="n">INVOKE</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">[](</span><span class="n">T</span><span class="o">&amp;</span><span class="p">){},</span> <span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">).</span><span class="n">second</span><span class="p">)</span></code> is valid.</p>
    <li data-md="">
     <p><code class="highlight"><span class="n">e</span></code> is a <code class="highlight"><span class="n">OnewayExecutor</span></code> or is convertible to a OnewayExecutor.</p>
    <li data-md="">
     <p><em>Postconditions:</em> No observable change to *this.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="n">E</span> <span class="nf">get_executor</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Returns:</em> If is_valid() returns true returns the executor contained within the
future. Otherwise throws std::future_error.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="n">standard_semi_future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span> <span class="n">semi</span><span class="p">();</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Returns:</em> Returns a standard_semi_future of the same value type as *this and that
  completes when this completes, but that erases the executor. is_valid() on the
  returned standard_semi_future will return the same value as is_valid() on
  *this.</p>
   </ul>
   <p><br></p>
<pre class="highlight"><span class="kt">bool</span> <span class="nf">valid</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
</pre>
   <ul>
    <li data-md="">
     <p><em>Returns:</em> Returns true if this is a valid future. False otherwise.</p>
   </ul>
   <h3 class="heading settled" data-level="2.10" id="stdthis_threadfuture_wait"><span class="secno">2.10. </span><span class="content"><code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">future_wait</span></code></span><a class="self-link" href="#stdthis_threadfuture_wait"></a></h3>
    In [thread.syn] and [thread.thread.this] extend <code class="highlight"><span class="n">this_thread</span></code> namespace: 
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Future</span><span class="o">></span>
  <span class="kt">void</span> <span class="n">future_wait</span><span class="p">(</span><span class="n">Future</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
</pre>
   <p><br> To [thread.thread.this] add:</p>
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Future</span><span class="o">></span>
  <span class="kt">void</span> <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">future_wait</span><span class="p">(</span><span class="n">Future</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
</pre>
   <ul>
    <li data-md="">
     <p>
      <em>Requires:</em> SemiFuture
      <future></future>
     </p>
    <li data-md="">
     <p><em>Effects:</em> Blocks the calling thread until <code class="highlight"><span class="n">f</span></code> becomes ready.</p>
    <li data-md="">
     <p><em>Synchronization:</em> The destruction of the continuation that generates <code class="highlight"><span class="n">f</span></code>'s
  value synchronizes-with the corresponding <code class="highlight"><span class="n">future_wait</span></code> return.</p>
   </ul>
   <p><br> <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">future_get</span></code></p>
   <hr>
    In [thread.syn] and [thread.thread.this] extend <code class="highlight"><span class="n">this_thread</span></code> namespace: 
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Future</span><span class="o">></span>
  <span class="k">auto</span> <span class="n">future_get</span><span class="p">(</span><span class="n">Future</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="o">-></span> <span class="n">Future</span><span class="o">::</span><span class="n">value_type</span><span class="p">;</span>
</pre>
   <p><br> To [thread.thread.this] add:</p>
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Future</span><span class="o">></span>
  <span class="k">auto</span> <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">future_get</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">>&amp;&amp;</span> <span class="n">f</span><span class="p">)</span>
    <span class="o">-></span> <span class="n">std</span><span class="o">::</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">>::</span><span class="n">value_type</span><span class="p">;</span>
</pre>
   <ul>
    <li data-md="">
     <p>
      <em>Requires:</em> SemiFuture
      <future></future>
     </p>
    <li data-md="">
     <p><em>Effects:</em> Blocks the calling thread until <code class="highlight"><span class="n">f</span></code> becomes ready.</p>
    <li data-md="">
     <p><em>Returns:</em></p>
     <ul>
      <li data-md="">
       <p>If <code class="highlight"><span class="n">f</span></code> becomes ready with a value, moves the value from <code class="highlight"><span class="n">f</span></code> and returns it
to the caller.</p>
      <li data-md="">
       <p>If <code class="highlight"><span class="n">f</span></code> becomes ready with an exception, rethrows the exception.</p>
     </ul>
    <li data-md="">
     <p><em>Synchronization:</em> The destruction of the continuation that generates <code class="highlight"><span class="n">f</span></code>'s
  value synchronizes-with the corresponding <code class="highlight"><span class="n">future_get</span></code> return.</p>
    <li data-md="">
     <p><em>Throws:</em> If <code class="highlight"><span class="n">f</span></code> becomes ready with an exception, that exception is rethrown.</p>
   </ul>
   <h2 class="heading settled" data-level="3" id="proposed-addition-to-executors-p0443"><span class="secno">3. </span><span class="content">Proposed Addition to Executors P0443</span><a class="self-link" href="#proposed-addition-to-executors-p0443"></a></h2>
   <p><a href="https://wg21.link/P0443">p0443</a> defines a collection of executor types intended
for use managing the execution of tasks on resources.
There are three fundamental executor categories that cover directionality and
control of launch:</p>
   <ul>
    <li data-md="">
     <p>one-way</p>
    <li data-md="">
     <p>two-way</p>
    <li data-md="">
     <p>then</p>
   </ul>
   <p>The first two could be considered <em>immediately launched</em>. That is that once
handed to the executor, they may start immediately, assuming the internal
executor policies and resources allow it. This makes them very useful for
lazy-launch scenarios.</p>
   <p>Lazy launch scenarios are common in callback-based code, and in a wide range of
future library implementations such as <a href="https://github.com/facebook/folly/tree/master/folly/futures">folly</a>.
In these designs, a callback is executed on completion of some asynchronous
work, and that callback enqueues work into the executor.
This means that work is enqueued only after all dependencies are satisfied.</p>
   <p>Then-executors, on the other hand, are intended for explicitly deferred work.
Work can be handed to the executor dependent on prior work, before that prior
work is completed.
This design is fundamentally different, but offers scope for optimization by
the executor of chains of dependencies that it can batch, without running
additional code on completion of each.</p>
   <p>The current executor design is intentionally generic - it makes few requirements
on the future types it can use as input dependencies for the <code class="highlight"><span class="n">then_execute</span></code> and <code class="highlight"><span class="n">bulk_then_execute</span></code> operations.
We can assume that for a future returned by a previous call to <code class="highlight"><span class="n">then_execute</span></code> or <code class="highlight"><span class="n">bulk_then_execute</span></code>, the executor understands the implementation of the
future can can perform whatever dependence tracking and optimization necessary.
This then is an implementation detail.</p>
   <p>However, there will also be interactions where a task to run on one executor is dependent on one produced by another. For this to be practical, we need a standardised mechanism to tie the two executors together.
This amounts to a standard API for triggering deferred work.</p>
   <h3 class="heading settled" data-level="3.1" id="proposed-solution"><span class="secno">3.1. </span><span class="content">Proposed solution</span><a class="self-link" href="#proposed-solution"></a></h3>
   <p>To solve this we provide two things:</p>
   <ul>
    <li data-md="">
     <p>A promise concept, that allows setting of value and/or exception.</p>
    <li data-md="">
     <p>A mechanism to retrieve from an executor a pair of a promise and a future, such that the future is a valid input dependence for a call to <code class="highlight"><span class="n">then_execute</span></code> or <code class="highlight"><span class="n">bulk_then_execute</span></code>.</p>
   </ul>
   <p>The promise is a write-only concept. This simplifies the definition and improves flexibility.</p>
   <p>The future is not a full future in the sense of future concepts. It is merely a token that completes when the promise is satisfied. This means that it is useful only for connecting to <code class="highlight"><span class="n">then_execute</span></code> or <code class="highlight"><span class="n">bulk_then_execute</span></code> on the executor that provided the result.</p>
   <h2 class="heading settled" data-level="4" id="proposed-new-wording①"><span class="secno">4. </span><span class="content">Proposed New Wording</span><a class="self-link" href="#proposed-new-wording①"></a></h2>
   <p>Wording supplements current text in <a href="https://wg21.link/P0443">p0443</a>.</p>
   <h3 class="heading settled" data-level="4.1" id="11x-promise-requirements"><span class="secno">4.1. </span><span class="content">1.1.x <code class="highlight"><span class="n">Promise</span></code> requirements</span><a class="self-link" href="#11x-promise-requirements"></a></h3>
   <p>A type <code class="highlight"><span class="n">P</span></code> meets the <code class="highlight"><span class="n">Promise</span></code> requirements for some value type <code class="highlight"><span class="n">T</span></code> if an
instance <code class="highlight"><span class="n">p</span></code> of <code class="highlight"><span class="n">P</span></code> satisfies the requirements in the table below. <code class="highlight"><span class="n">T</span></code> may be
void.</p>
   <table>
    <tbody>
     <tr>
      <th>Expression
      <th>Return Type
      <th>Operational semantics
     <tr>
      <td><code class="highlight"><span class="n">p</span><span class="p">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">T</span><span class="p">)</span></code>
      <td>void
      <td>Completes the promise with a value.
     <tr>
      <td><code class="highlight"><span class="n">p</span><span class="p">.</span><span class="n">set_exception</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">exception_ptr</span><span class="p">)</span></code>
      <td>void
      <td>Completes the promise with an exception wrapped in a <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">exception_ptr</span></code>.
   </table>
   <h3 class="heading settled" data-level="4.2" id="1332-promise-contract"><span class="secno">4.2. </span><span class="content">1.3.3.2 Promise contract</span><a class="self-link" href="#1332-promise-contract"></a></h3>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">></span>
<span class="k">struct</span> <span class="n">promise_contract_t</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">bool</span> <span class="n">is_requirable</span> <span class="o">=</span> false<span class="p">;</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">bool</span> <span class="n">is_preferable</span> <span class="o">=</span> false<span class="p">;</span>

  <span class="k">using</span> <span class="n">polymorphic_query_result_type</span>
    <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">promise</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">>></span><span class="p">;</span>

  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Executor</span><span class="o">></span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="n">static_query_v</span>
    <span class="o">=</span> <span class="n">Executor</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">promise_contract_t</span><span class="p">());</span>
<span class="p">};</span>
</pre>
   <p>The <code class="highlight"><span class="n">promise_contract_t</span></code> property can be used only with query.</p>
   <p>The result of a query of the <code class="highlight"><span class="n">promise_contract_t</span></code> property applied to a <code class="highlight"><span class="n">ThenExecutor</span></code> or <code class="highlight"><span class="n">BulkThenExecutor</span></code> is a <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">pair</span></code> consisting of a <code class="highlight"><span class="n">Promise</span></code> and an implementation-defined token type that will be interpreted as a valid
input future by calls to <code class="highlight"><span class="n">then_execute</span></code> or <code class="highlight"><span class="n">bulk_then_execute</span></code> and that is
satisfied by calling <code class="highlight"><span class="n">set_value</span></code> or <code class="highlight"><span class="n">set_exception</span></code> on the promise.</p>
   <p>The value returned from <code class="highlight"><span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">)</span></code>, where <code class="highlight"><span class="n">e</span></code> is an executor and <code class="highlight"><span class="n">T</span></code> is a type, should be unique for any given call.
When <code class="highlight"><span class="n">e</span></code> is a <code class="highlight"><span class="n">ThenExecutor</span></code> or <code class="highlight"><span class="n">BulkThenExecutor</span></code> the result of the query is a <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">pair</span></code> where first value is an instance of a type matching the <code class="highlight"><span class="n">Promise</span></code> requirements and the second is a token type that <code class="highlight"><span class="n">e</span></code> will interpret as a valid
future parameter to calls to <code class="highlight"><span class="n">then_execute</span></code> or <code class="highlight"><span class="n">bulk_then_execute</span></code>.
When <code class="highlight"><span class="n">e</span></code> is neither a <code class="highlight"><span class="n">ThenExecutor</span></code> nor a <code class="highlight"><span class="n">BulkThenExecutor</span></code> the result of the
query is a <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">pair</span></code> where the first value is a <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">promise</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span></code> and the
second is a <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span></code> such that the future was retrieved from the
promise.</p>
   <h3 class="heading settled" data-level="4.3" id="1332-cancellable-promise-contract"><span class="secno">4.3. </span><span class="content">1.3.3.2 Cancellable promise contract</span><a class="self-link" href="#1332-cancellable-promise-contract"></a></h3>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="o">></span>
<span class="k">struct</span> <span class="n">cancellable_promise_contract_t</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">bool</span> <span class="n">is_requirable</span> <span class="o">=</span> false<span class="p">;</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">bool</span> <span class="n">is_preferable</span> <span class="o">=</span> false<span class="p">;</span>

  <span class="k">using</span> <span class="n">polymorphic_query_result_type</span>
    <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">promise</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">>></span><span class="p">;</span>

  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Executor</span><span class="o">></span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="n">static_query_v</span>
    <span class="o">=</span> <span class="n">Executor</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">promise_contract_t</span><span class="p">());</span>

  <span class="n">CancellationCallback</span> <span class="n">cancellation_callback</span><span class="p">;</span>
<span class="p">};</span>
</pre>
   <p>The <code class="highlight"><span class="n">cancellable_promise_contract_t</span></code> property can be used only with query. <code class="highlight"><span class="n">cancellable_promise_contract_t</span></code> differs from <code class="highlight"><span class="n">promise_contract_t</span></code> in that the
query carries a cancellation callback, <code class="highlight"><span class="n">cancellation_callback</span></code>, that will be
called as <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">invoke</span><span class="p">(</span><span class="n">cancellation_callback</span><span class="p">)</span></code> by the <code class="highlight"><span class="n">ThenExecutor</span></code> on
cancellation of the task dependent on the future resulting from the <code class="highlight"><span class="n">cancellable_promise_contract_t</span></code> query.</p>
   <p>The result of a query of the <code class="highlight"><span class="n">cancellable_promise_contract_t</span></code> property applied
to a <code class="highlight"><span class="n">ThenExecutor</span></code> or <code class="highlight"><span class="n">BulkThenExecutor</span></code> is a <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">pair</span></code> consisting of a <code class="highlight"><span class="n">Promise</span></code> and an implementation-defined token type that will be interpreted as
a valid input future by calls to <code class="highlight"><span class="n">then_execute</span></code> or <code class="highlight"><span class="n">bulk_then_execute</span></code>, that
is satisfied by calling <code class="highlight"><span class="n">set_value</span></code> or <code class="highlight"><span class="n">set_exception</span></code> on the promise and that
supports cancellation by the executor.</p>
   <p>The value returned from <code class="highlight"><span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">cancellable_promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">{</span><span class="n">cancellation_callback</span><span class="p">})</span></code>,
where <code class="highlight"><span class="n">e</span></code> is an executor and <code class="highlight"><span class="n">T</span></code> is a type, should be unique for any given call.
When <code class="highlight"><span class="n">e</span></code> is a <code class="highlight"><span class="n">ThenExecutor</span></code> or <code class="highlight"><span class="n">BulkThenExecutor</span></code> the result of the query is a <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">pair</span></code> where first value is an instance of a type matching the <code class="highlight"><span class="n">Promise</span></code> requirements and the second is a token type that <code class="highlight"><span class="n">e</span></code> will interpret as a valid
future parameter to calls to <code class="highlight"><span class="n">then_execute</span></code> or <code class="highlight"><span class="n">bulk_then_execute</span></code>.
When <code class="highlight"><span class="n">e</span></code> is neither a <code class="highlight"><span class="n">ThenExecutor</span></code> nor a <code class="highlight"><span class="n">BulkThenExecutor</span></code> the result of the
query is a <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">pair</span></code> where the first value is a <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">promise</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span></code> and the
second is a <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span></code> such that the future was retrieved from the
promise.</p>
   <h2 class="heading settled" data-level="5" id="proposed-modifications-to-executors-p0443"><span class="secno">5. </span><span class="content">Proposed Modifications to Executors P0443</span><a class="self-link" href="#proposed-modifications-to-executors-p0443"></a></h2>
    <a href="https://wg21.link/P0443">p0443</a> currently requires <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">experimental</span><span class="o">::</span><span class="n">future</span></code> due to the absence of a complete future type in the core standard. 
   <p>This paper provides the wider set of tasks and as a result, the current text in <a href="https://wg21.link/P0443">p0443</a> should be modified as follows.</p>
   <h3 class="heading settled" data-level="5.1" id="future-requirements"><span class="secno">5.1. </span><span class="content">Future requirements</span><a class="self-link" href="#future-requirements"></a></h3>
    Drop this entire section and replace with the <code class="highlight"><span class="n">Future</span></code> requirements from this
paper. 
   <h3 class="heading settled" data-level="5.2" id="twowayexecutor-requirements"><span class="secno">5.2. </span><span class="content">TwoWayExecutor requirements</span><a class="self-link" href="#twowayexecutor-requirements"></a></h3>
    In the <em>Return Type</em> column. 
   <p><strong>Replace:</strong> A type that satisfies the Future requirements for the value type R.</p>
   <p><strong>With:</strong> A type that satisfies the ContinuableFuture requirements for the value
type R and for which <code class="highlight"><span class="n">returnvalue</span><span class="p">.</span><span class="n">get_executor</span><span class="p">()</span></code> returns x.</p>
   <p>In the <em>Operational Semantics</em> column.</p>
   <p><strong>Replace:</strong> in the associated shared state of the resulting Future.</p>
   <p><strong>With:</strong> in the resulting ContinuableFuture.</p>
   <h3 class="heading settled" data-level="5.3" id="thenexecutor-requirements"><span class="secno">5.3. </span><span class="content">ThenExecutor requirements</span><a class="self-link" href="#thenexecutor-requirements"></a></h3>
    In the type requirements list. 
   <p><strong>Replace:</strong></p>
   <ul>
    <li data-md="">
     <p>fut denotes a future object satisfying the Future requirements,</p>
   </ul>
   <p><strong>With:</strong></p>
   <ul>
    <li data-md="">
     <p>fut denotes a future object that:</p>
     <ul>
      <li data-md="">
       <p>was returned by a call to <code class="highlight"><span class="n">x</span><span class="p">.</span><span class="n">twoway_execute</span></code>, <code class="highlight"><span class="n">x</span><span class="p">.</span><span class="n">bulk_twoway_execute</span></code>, <code class="highlight"><span class="n">x</span><span class="p">.</span><span class="n">then_execute</span></code>, or <code class="highlight"><span class="n">x</span><span class="p">.</span><span class="n">bulk_then_execute</span></code> and meets the <code class="highlight"><span class="n">ContinuableFuture</span></code> requirements.</p>
      <li data-md="">
       <p>was returned by a call to <code class="highlight"><span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">)</span></code> or <code class="highlight"><span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cancellable_promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">)</span></code></p>
     </ul>
   </ul>
   <p>In the <em>Return Type</em> column.</p>
   <p><strong>Replace:</strong> A type that satisfies the Future requirements for the value type R.</p>
   <p><strong>With:</strong> A type that satisfies the ContinuableFuture requirements for the value
type R and for which <code class="highlight"><span class="n">returnvalue</span><span class="p">.</span><span class="n">get_executor</span><span class="p">()</span></code> returns x.</p>
   <p>In the <em>Operational Semantics</em> column.</p>
   <p><strong>Replace:</strong> in the associated shared state of the resulting Future.</p>
   <p><strong>With:</strong> in the resulting ContinuableFuture.</p>
   <h3 class="heading settled" data-level="5.4" id="bulktwowayexecutor-requirements"><span class="secno">5.4. </span><span class="content">BulkTwoWayExecutor requirements</span><a class="self-link" href="#bulktwowayexecutor-requirements"></a></h3>
    In the <em>Return Type</em> column. 
   <p><strong>Replace:</strong> A type that satisfies the Future requirements for the value type R.</p>
   <p><strong>With:</strong> A type that satisfies the ContinuableFutureFuture requirements for the value
type R and for which <code class="highlight"><span class="n">returnvalue</span><span class="p">.</span><span class="n">get_executor</span><span class="p">()</span></code> returns x.</p>
   <p>In the <em>Operational Semantics</em> column.</p>
   <p><strong>Replace:</strong> in the associated shared state of the resulting Future.</p>
   <p><strong>With:</strong> in the resulting ContinuableFuture.</p>
   <h3 class="heading settled" data-level="5.5" id="bulkthenexecutor-requirements"><span class="secno">5.5. </span><span class="content">BulkThenExecutor requirements</span><a class="self-link" href="#bulkthenexecutor-requirements"></a></h3>
    In the type requirements list. 
   <p><strong>Replace:</strong></p>
   <ul>
    <li data-md="">
     <p>fut denotes a future object satisfying the Future requirements,</p>
   </ul>
   <p><strong>With:</strong></p>
   <ul>
    <li data-md="">
     <p>fut denotes a future object that:</p>
     <ul>
      <li data-md="">
       <p>was returned by a call to <code class="highlight"><span class="n">x</span><span class="p">.</span><span class="n">twoway_execute</span></code>, <code class="highlight"><span class="n">x</span><span class="p">.</span><span class="n">bulk_twoway_execute</span></code>, <code class="highlight"><span class="n">x</span><span class="p">.</span><span class="n">then_execute</span></code>, or <code class="highlight"><span class="n">x</span><span class="p">.</span><span class="n">bulk_then_execute</span></code> and meets the <code class="highlight"><span class="n">ContinuableFuture</span></code> requirements.</p>
      <li data-md="">
       <p>was returned by a call to <code class="highlight"><span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">)</span></code> or <code class="highlight"><span class="n">execution</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cancellable_promise_contract_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">)</span></code>.</p>
     </ul>
   </ul>
   <p>In the <em>Return Type</em> column.</p>
   <p><strong>Replace:</strong> A type that satisfies the Future requirements for the value type R.</p>
   <p><strong>With:</strong> A type that satisfies the ContinuableFutureFuture requirements for the value
type R and for which <code class="highlight"><span class="n">returnvalue</span><span class="p">.</span><span class="n">get_executor</span><span class="p">()</span></code> returns x.</p>
   <p>In the <em>Operational Semantics</em> column.</p>
   <p><strong>Replace:</strong> in the associated shared state of the resulting Future.</p>
   <p><strong>With:</strong> in the resulting ContinuableFuture.</p>
   <h3 class="heading settled" data-level="5.6" id="twoway_t-customization-points"><span class="secno">5.6. </span><span class="content">twoway_t customization points</span><a class="self-link" href="#twoway_t-customization-points"></a></h3>
    <strong>Replace:</strong> 
   <p>it is <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">experimental</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span></code></p>
   <p><strong>with:</strong></p>
   <p>it is <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">standard_continuable_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E1</span><span class="o">></span></code> such that a call to</p>
    <code class="highlight"><span class="n">get_executor</span><span class="p">()</span></code> returns a copy of <code class="highlight"><span class="n">e1</span></code> 
   <h3 class="heading settled" data-level="5.7" id="single_t-customization-points"><span class="secno">5.7. </span><span class="content">single_t customization points</span><a class="self-link" href="#single_t-customization-points"></a></h3>
    <strong>Replace:</strong> 
   <p>it is <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">experimental</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span></code></p>
   <p><strong>with:</strong></p>
   <p>it is <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">standard_continuable_future</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E1</span><span class="o">></span></code> such that a call to <code class="highlight"><span class="n">get_executor</span><span class="p">()</span></code> returns a copy of <code class="highlight"><span class="n">e1</span></code></p>
   <h3 class="heading settled" data-level="5.8" id="properties-to-indicate-if-blocking-and-directionality-may-be-adapted"><span class="secno">5.8. </span><span class="content">Properties to indicate if blocking and directionality may be adapted</span><a class="self-link" href="#properties-to-indicate-if-blocking-and-directionality-may-be-adapted"></a></h3>
    Remove <code class="highlight"><span class="n">twoway_t</span></code> from the <strong>Requirements</strong> column of hte table. 
   <p>Remove note referring to <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">experimental</span><span class="o">::</span><span class="n">future</span></code>.</p>
   <p>[<em>Note:</em> <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">experimental</span><span class="o">::</span><span class="n">future</span></code> is not used and the replacemnt does not
 have a blocking wait so this is no longer relevant.]</p>
   <h3 class="heading settled" data-level="5.9" id="class-template-executor"><span class="secno">5.9. </span><span class="content">Class template executor</span><a class="self-link" href="#class-template-executor"></a></h3>
    <strong>Replace:</strong> 
<pre class="highlight">  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Function</span><span class="o">></span>
    <span class="n">std</span><span class="o">::</span><span class="n">experimental</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">result_of_t</span><span class="o">&lt;</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">Function</span><span class="o">></span><span class="p">()</span><span class="o">>></span>
      <span class="n">twoway_execute</span><span class="p">(</span><span class="n">Function</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="k">const</span>
</pre>
   <p><strong>With:</strong></p>
<pre class="highlight">  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Function</span><span class="o">></span>
    <span class="n">std</span><span class="o">::</span><span class="n">standard_semi_future</span><span class="o">&lt;</span><span class="n">result_of_t</span><span class="o">&lt;</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">Function</span><span class="o">></span><span class="p">()</span><span class="o">>></span>
      <span class="n">twoway_execute</span><span class="p">(</span><span class="n">Function</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="k">const</span>
</pre>
   <p><strong>Replace:</strong></p>
<pre class="highlight">  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Function</span><span class="p">,</span> <span class="k">class</span> <span class="nc">ResultFactory</span><span class="p">,</span> <span class="k">class</span> <span class="nc">SharedFactory</span><span class="o">></span>
    <span class="n">std</span><span class="o">::</span><span class="n">experimental</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">result_of_t</span><span class="o">&lt;</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">ResultFactory</span><span class="o">></span><span class="p">()</span><span class="o">>></span>
      <span class="n">bulk_twoway_execute</span><span class="p">(</span><span class="n">Function</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="n">ResultFactory</span><span class="o">&amp;&amp;</span> <span class="n">rf</span><span class="p">,</span> <span class="n">SharedFactory</span><span class="o">&amp;&amp;</span> <span class="n">sf</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</pre>
   <p><strong>With:</strong></p>
<pre class="highlight">  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Function</span><span class="p">,</span> <span class="k">class</span> <span class="nc">ResultFactory</span><span class="p">,</span> <span class="k">class</span> <span class="nc">SharedFactory</span><span class="o">></span>
    <span class="n">std</span><span class="o">::</span><span class="n">standard_semi_future</span><span class="o">&lt;</span><span class="n">result_of_t</span><span class="o">&lt;</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">ResultFactory</span><span class="o">></span><span class="p">()</span><span class="o">>></span>
      <span class="n">bulk_twoway_execute</span><span class="p">(</span><span class="n">Function</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="n">ResultFactory</span><span class="o">&amp;&amp;</span> <span class="n">rf</span><span class="p">,</span> <span class="n">SharedFactory</span><span class="o">&amp;&amp;</span> <span class="n">sf</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</pre>
   <p>[<em>Note:</em> We lose the executor information here. Potentially we should encode
 the future type, including its executor, in the properties of the polymorphic
 wrapper.]</p>
   <h3 class="heading settled" data-level="5.10" id="executor-operations"><span class="secno">5.10. </span><span class="content">executor operations</span><a class="self-link" href="#executor-operations"></a></h3>
    <strong>Replace:</strong> 
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Function</span><span class="o">></span>
  <span class="n">std</span><span class="o">::</span><span class="n">experimental</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">result_of_t</span><span class="o">&lt;</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">Function</span><span class="o">></span><span class="p">()</span><span class="o">>></span>
    <span class="n">twoway_execute</span><span class="p">(</span><span class="n">Function</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="k">const</span>
</pre>
   <p><strong>With:</strong></p>
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Function</span><span class="o">></span>
  <span class="cm">/* implementation-defined future type */</span>
    <span class="n">twoway_execute</span><span class="p">(</span><span class="n">Function</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="n">con</span>
</pre>
   <p><strong>Replace:</strong></p>
   <p>Returns: A future, whose shared state is made ready when the future returned by
e.twoway_execute(f2) is made ready, containing the result of f1() or any
exception thrown by f1(). [Note: e2.twoway_execute(f2) may return any future
type that satisfies the Future requirements, and not necessarily
std::experimental::future. One possible implementation approach is for the
polymorphic wrapper to attach a continuation to the inner future via that
object’s then() member function. When invoked, this continuation stores the
result in the outer future’s associated shared and makes that shared state
ready. --end note]</p>
   <p><strong>With:</strong></p>
   <p><em>Returns:</em> A value whose type satisfies the <code class="highlight"><span class="n">ContinuableFuture</span></code> requirements.
The returned future is made ready when <code class="highlight"><span class="n">f1</span><span class="p">()</span></code> completes execution, with the
result of <code class="highlight"><span class="n">f1</span><span class="p">()</span></code> if <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">f1</span><span class="p">())</span></code> is non-void, void completion if <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">f1</span><span class="p">())</span></code> is void or any exception thrown by <code class="highlight"><span class="n">f1</span><span class="p">()</span></code>.</p>
   <p><strong>Replace:</strong></p>
   <p>
    template
    <class class="" functionU0002C="" resultfactoryU0002C="" sharedfactory="">
      std::experimental::future
     <result_of_tU0003Cdecay_tU0003Cresultfactory>()>>
    void bulk_twoway_execute(Function&amp;&amp; f, size_t n, ResultFactory&amp;&amp; rf, SharedFactory&amp;&amp; sf) const;</result_of_tU0003Cdecay_tU0003Cresultfactory>
    </class>
   </p>
   <p><strong>With:</strong></p>
<pre class="highlight"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Function</span><span class="p">,</span> <span class="k">class</span> <span class="nc">ResultFactory</span><span class="p">,</span> <span class="k">class</span> <span class="nc">SharedFactory</span><span class="o">></span>
  <span class="cm">/* implementation-defined future type */</span>
     <span class="n">bulk_twoway_execute</span><span class="p">(</span><span class="n">Function</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="n">ResultFactory</span><span class="o">&amp;&amp;</span> <span class="n">rf</span><span class="p">,</span> <span class="n">SharedFactory</span><span class="o">&amp;&amp;</span> <span class="n">sf</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</pre>
   <p><strong>Replace:</strong></p>
   <p><em>Returns:</em> A future, whose shared state is made ready when the future returned
by e.bulk_twoway_execute(f2, n, rf2, sf2) is made ready, containing the result
in r1 (if decltype(rf1()) is non-void) or any exception thrown by an
invocationf1. [Note: e.bulk_twoway_execute(f2) may greturn any future type that
satisfies the Future requirements, and not necessarily std::experimental::future.
One possible implementation approach is for the polymorphic wrapper to attach a
continuation to the inner future via that object’s then() member function. When
invoked, this continuation stores the result in the outer future’s associated
shared and makes that shared state ready. --end note]</p>
   <p><strong>With:</strong></p>
   <p><em>Returns:</em> A value whose type satisfies the <code class="highlight"><span class="n">ContinuableFuture</span></code> requirements.
The returned future is made ready when <code class="highlight"><span class="n">f1</span><span class="p">()</span></code> completes execution, with
the result in <code class="highlight"><span class="n">r1</span></code> (if <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">rf1</span><span class="p">())</span></code> is non-void), valueless completion
(if <code class="highlight"><span class="k">decltype</span><span class="p">(</span><span class="n">rf1</span><span class="p">())</span></code> is void) or any exception thrown by an invocation <code class="highlight"><span class="n">f1</span></code>.</p>
   <h3 class="heading settled" data-level="5.11" id="static_thread_pool-executor-types"><span class="secno">5.11. </span><span class="content">static_thread_pool executor types</span><a class="self-link" href="#static_thread_pool-executor-types"></a></h3>
    <strong>Replace:</strong> 
<pre class="highlight">    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Function</span><span class="o">></span>
      <span class="n">std</span><span class="o">::</span><span class="n">experimental</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">result_of_t</span><span class="o">&lt;</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">Function</span><span class="o">></span><span class="p">()</span><span class="o">>></span>
        <span class="n">twoway_execute</span><span class="p">(</span><span class="n">Function</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="k">const</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Function</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Future</span><span class="o">></span>
      <span class="n">std</span><span class="o">::</span><span class="n">experimental</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">result_of_t</span><span class="o">&lt;</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">Function</span><span class="o">></span><span class="p">(</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">></span><span class="p">)</span><span class="o">>></span>
        <span class="n">then_execute</span><span class="p">(</span><span class="n">Function</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="n">Future</span><span class="o">&amp;&amp;</span> <span class="n">pred</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Function</span><span class="p">,</span> <span class="k">class</span> <span class="nc">SharedFactory</span><span class="o">></span>
      <span class="kt">void</span> <span class="n">bulk_execute</span><span class="p">(</span><span class="n">Function</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="n">SharedFactory</span><span class="o">&amp;&amp;</span> <span class="n">sf</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Function</span><span class="p">,</span> <span class="k">class</span> <span class="nc">ResultFactory</span><span class="p">,</span> <span class="k">class</span> <span class="nc">SharedFactory</span><span class="o">></span>
      <span class="n">std</span><span class="o">::</span><span class="n">experimental</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">result_of_t</span><span class="o">&lt;</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">ResultFactory</span><span class="o">></span><span class="p">()</span><span class="o">>></span>
        <span class="kt">void</span> <span class="n">bulk_twoway_execute</span><span class="p">(</span><span class="n">Function</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="n">ResultFactory</span><span class="o">&amp;&amp;</span> <span class="n">rf</span><span class="p">,</span> <span class="n">SharedFactory</span><span class="o">&amp;&amp;</span> <span class="n">sf</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</pre>
   <p><strong>With:</strong></p>
<pre class="highlight">  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Function</span><span class="o">></span>
    <span class="n">std</span><span class="o">::</span><span class="n">standard_continuable_future</span><span class="o">&lt;</span><span class="n">result_of_t</span><span class="o">&lt;</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">Function</span><span class="o">></span><span class="p">()</span><span class="o">></span><span class="p">,</span> <span class="n">C</span><span class="o">></span>
      <span class="n">twoway_execute</span><span class="p">(</span><span class="n">Function</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="k">const</span>

  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Function</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Future</span><span class="o">></span>
    <span class="n">std</span><span class="o">::</span><span class="n">standard_continuable_future</span><span class="o">&lt;</span><span class="n">result_of_t</span><span class="o">&lt;</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">Function</span><span class="o">></span><span class="p">(</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">></span><span class="p">)</span><span class="o">></span><span class="p">,</span> <span class="n">C</span><span class="o">></span>
      <span class="n">then_execute</span><span class="p">(</span><span class="n">Function</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="n">Future</span><span class="o">&amp;&amp;</span> <span class="n">pred</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>

  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Function</span><span class="p">,</span> <span class="k">class</span> <span class="nc">SharedFactory</span><span class="o">></span>
    <span class="kt">void</span> <span class="n">bulk_execute</span><span class="p">(</span><span class="n">Function</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="n">SharedFactory</span><span class="o">&amp;&amp;</span> <span class="n">sf</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>

  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Function</span><span class="p">,</span> <span class="k">class</span> <span class="nc">ResultFactory</span><span class="p">,</span> <span class="k">class</span> <span class="nc">SharedFactory</span><span class="o">></span>
    <span class="n">std</span><span class="o">::</span><span class="n">standard_continuable_future</span><span class="o">&lt;</span><span class="n">result_of_t</span><span class="o">&lt;</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="n">ResultFactory</span><span class="o">></span><span class="p">()</span><span class="o">>></span><span class="p">,</span> <span class="n">C</span><span class="o">></span>
      <span class="kt">void</span> <span class="n">bulk_twoway_execute</span><span class="p">(</span><span class="n">Function</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="n">ResultFactory</span><span class="o">&amp;&amp;</span> <span class="n">rf</span><span class="p">,</span> <span class="n">SharedFactory</span><span class="o">&amp;&amp;</span> <span class="n">sf</span><span class="p">)</span> <span class="k">const</span>
</pre>
   <p>Replace the same instances in the documentation section below the main code
block.</p>
  </main>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don’t scroll to compensate for the ToC if we’re above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don’t know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn’t exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn’t standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don’t have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we’re at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can’t find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#continuable-future">continuable future</a><span>, in §2.4</span>
   <li><a href="#future">future</a><span>, in §2.1</span>
   <li><a href="#futures-content">future content</a><span>, in §2.1</span>
   <li><a href="#future-continuation">future continuation</a><span>, in §2.2</span>
   <li><a href="#futures-content">future’s content</a><span>, in §2.1</span>
   <li><a href="#futures-status">future’s status</a><span>, in §2.1</span>
   <li><a href="#futures-status">future status</a><span>, in §2.1</span>
   <li><a href="#invalid">invalid</a><span>, in §2.1</span>
   <li><a href="#invalid">invalid future</a><span>, in §2.1</span>
   <li><a href="#made-invalid">made invalid</a><span>, in §2.1</span>
   <li><a href="#made-ready">made ready</a><span>, in §2.1</span>
   <li><a href="#made-invalid">make invalid</a><span>, in §2.1</span>
   <li><a href="#made-ready">make ready</a><span>, in §2.1</span>
   <li><a href="#not-ready">not ready</a><span>, in §2.1</span>
   <li><a href="#not-ready">not ready future</a><span>, in §2.1</span>
   <li><a href="#ready">ready</a><span>, in §2.1</span>
   <li><a href="#ready">ready future</a><span>, in §2.1</span>
   <li><a href="#semi-future">semi future</a><span>, in §2.3</span>
   <li><a href="#shared-future">shared future</a><span>, in §2.5</span>
   <li><a href="#valid">valid</a><span>, in §2.1</span>
   <li><a href="#valid">valid future</a><span>, in §2.1</span>
  </ul>
  <aside class="dfn-panel" data-for="future">
   <b><a href="#future">#future</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-future">2.1. Futures</a>
    <li><a href="#ref-for-future①">2.2. FutureContinuation Requirements</a> <a href="#ref-for-future②">(2)</a> <a href="#ref-for-future③">(3)</a> <a href="#ref-for-future④">(4)</a>
    <li><a href="#ref-for-future⑤">2.3. SemiFuture Requirements</a>
    <li><a href="#ref-for-future⑥">2.4. ContinuableFuture Requirements</a>
    <li><a href="#ref-for-future⑦">2.5. SharedFuture Requirements</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="futures-content">
   <b><a href="#futures-content">#futures-content</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-futures-content">2.1. Futures</a> <a href="#ref-for-futures-content①">(2)</a> <a href="#ref-for-futures-content②">(3)</a> <a href="#ref-for-futures-content③">(4)</a> <a href="#ref-for-futures-content④">(5)</a> <a href="#ref-for-futures-content⑤">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="futures-status">
   <b><a href="#futures-status">#futures-status</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-futures-status">2.1. Futures</a> <a href="#ref-for-futures-status①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="not-ready">
   <b><a href="#not-ready">#not-ready</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-not-ready">2.1. Futures</a> <a href="#ref-for-not-ready①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="ready">
   <b><a href="#ready">#ready</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ready">2.1. Futures</a> <a href="#ref-for-ready①">(2)</a> <a href="#ref-for-ready②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="invalid">
   <b><a href="#invalid">#invalid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-invalid">2.1. Futures</a> <a href="#ref-for-invalid①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="future-continuation">
   <b><a href="#future-continuation">#future-continuation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-future-continuation">2.2. FutureContinuation Requirements</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

        document.body.addEventListener("click", function(e) {
            var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while(el.parentElement) {
                if(el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if(el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if(el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if(target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if(target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if(dfnPanel) {
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if(target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
        </script>